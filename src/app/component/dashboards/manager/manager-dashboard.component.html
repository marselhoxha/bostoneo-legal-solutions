<!-- Manager Dashboard -->
<div class="row">
  <!-- Dashboard Header -->
  <div class="col-12">
    <div class="page-title-box d-sm-flex align-items-center justify-content-between mb-4">
      <div>
        <h4 class="mb-sm-0">{{ managerType }} Manager Dashboard</h4>
        <p class="text-muted mb-0">Department Overview & Team Management</p>
      </div>
      <div class="page-title-right">
        <button class="btn btn-primary btn-sm" (click)="refreshDashboard()">
          <i class="ri-refresh-line me-1"></i> Refresh
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Dashboard Metrics -->
<div class="row">
  <!-- Team Members -->
  <div class="col-xl-3 col-md-6">
    <div class="card card-animate">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="avatar-sm flex-shrink-0">
            <span class="avatar-title bg-primary-subtle text-primary rounded-2 fs-2">
              <i class="ri-team-line"></i>
            </span>
          </div>
          <div class="flex-grow-1 ms-3">
            <p class="text-uppercase fw-medium text-muted mb-1">Team Members</p>
            <h4 class="mb-0">{{ teamMembers }}</h4>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Active Cases / Metrics -->
  <div class="col-xl-3 col-md-6" *ngIf="managerType === 'Practice'">
    <div class="card card-animate">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="avatar-sm flex-shrink-0">
            <span class="avatar-title bg-success-subtle text-success rounded-2 fs-2">
              <i class="ri-briefcase-line"></i>
            </span>
          </div>
          <div class="flex-grow-1 ms-3">
            <p class="text-uppercase fw-medium text-muted mb-1">Active Cases</p>
            <h4 class="mb-0">{{ activeCases }}</h4>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pending Approvals -->
  <div class="col-xl-3 col-md-6">
    <div class="card card-animate">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="avatar-sm flex-shrink-0">
            <span class="avatar-title bg-warning-subtle text-warning rounded-2 fs-2">
              <i class="ri-checkbox-circle-line"></i>
            </span>
          </div>
          <div class="flex-grow-1 ms-3">
            <p class="text-uppercase fw-medium text-muted mb-1">Pending Approvals</p>
            <h4 class="mb-0">{{ pendingApprovals }}</h4>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Department Efficiency -->
  <div class="col-xl-3 col-md-6">
    <div class="card card-animate">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="avatar-sm flex-shrink-0">
            <span class="avatar-title bg-info-subtle text-info rounded-2 fs-2">
              <i class="ri-line-chart-line"></i>
            </span>
          </div>
          <div class="flex-grow-1 ms-3">
            <p class="text-uppercase fw-medium text-muted mb-1">Efficiency</p>
            <h4 class="mb-0">{{ departmentEfficiency }}%</h4>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Budget Metrics (Finance Manager) -->
  <div class="col-xl-3 col-md-6" *ngIf="managerType === 'Finance'">
    <div class="card card-animate">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="avatar-sm flex-shrink-0">
            <span class="avatar-title bg-success-subtle text-success rounded-2 fs-2">
              <i class="ri-money-dollar-circle-line"></i>
            </span>
          </div>
          <div class="flex-grow-1 ms-3">
            <p class="text-uppercase fw-medium text-muted mb-1">Monthly Budget</p>
            <h4 class="mb-0">${{ (monthlyBudget/1000).toFixed(0) }}K</h4>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Charts Row -->
<div class="row">
  <!-- Team Performance Chart -->
  <div class="col-xl-8">
    <div class="card">
      <div class="card-header align-items-center d-flex">
        <h4 class="card-title mb-0 flex-grow-1">Team Performance Overview</h4>
        <a href="javascript:void(0);" class="link-primary" (click)="navigateToTeam()">View Details</a>
      </div>
      <div class="card-body">
        <apx-chart
          *ngIf="performanceChart"
          [series]="performanceChart.series"
          [chart]="performanceChart.chart"
          [xaxis]="performanceChart.xaxis"
          [stroke]="performanceChart.stroke"
          [fill]="performanceChart.fill"
          [colors]="performanceChart.colors"
        ></apx-chart>
      </div>
    </div>
  </div>

  <!-- Efficiency Gauges -->
  <div class="col-xl-4">
    <div class="row">
      <!-- Budget Utilization -->
      <div class="col-12" *ngIf="managerType === 'Finance' || managerType === 'Practice'">
        <div class="card">
          <div class="card-header">
            <h4 class="card-title mb-0">Budget Utilization</h4>
          </div>
          <div class="card-body">
            <apx-chart
              *ngIf="budgetChart"
              [series]="budgetChart.series"
              [chart]="budgetChart.chart"
              [plotOptions]="budgetChart.plotOptions"
              [colors]="budgetChart.colors"
              [labels]="budgetChart.labels"
            ></apx-chart>
          </div>
        </div>
      </div>

      <!-- Department Efficiency -->
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h4 class="card-title mb-0">Department Efficiency</h4>
          </div>
          <div class="card-body">
            <apx-chart
              *ngIf="efficiencyChart"
              [series]="efficiencyChart.series"
              [chart]="efficiencyChart.chart"
              [plotOptions]="efficiencyChart.plotOptions"
              [colors]="efficiencyChart.colors"
              [labels]="efficiencyChart.labels"
            ></apx-chart>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Team Performance Table -->
<div class="row">
  <div class="col-xl-8">
    <div class="card">
      <div class="card-header align-items-center d-flex">
        <h4 class="card-title mb-0 flex-grow-1">Team Performance Metrics</h4>
        <a href="javascript:void(0);" class="link-primary" (click)="navigateToReports()">View Reports</a>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead>
              <tr>
                <th>Team Member</th>
                <th>Role</th>
                <th>Efficiency</th>
                <th *ngIf="managerType === 'Practice'">Cases</th>
                <th *ngIf="managerType === 'Practice'">Billable Hours</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let member of teamPerformance">
                <td>
                  <div class="d-flex align-items-center">
                    <div class="avatar-xs me-3">
                      <span class="avatar-title rounded-circle bg-primary-subtle text-primary">
                        {{ member.name.charAt(0) }}
                      </span>
                    </div>
                    <div>
                      <h6 class="mb-0">{{ member.name }}</h6>
                    </div>
                  </div>
                </td>
                <td>{{ member.role }}</td>
                <td>
                  <span [class]="getEfficiencyClass(member.efficiency)">
                    {{ member.efficiency }}%
                  </span>
                </td>
                <td *ngIf="managerType === 'Practice'">{{ member.cases }}</td>
                <td *ngIf="managerType === 'Practice'">{{ member.billableHours }}</td>
                <td>
                  <button class="btn btn-sm btn-link" (click)="viewTeamMember(member.id)">
                    <i class="ri-eye-line"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Pending Approvals -->
  <div class="col-xl-4">
    <div class="card">
      <div class="card-header">
        <h4 class="card-title mb-0">Pending Approvals</h4>
      </div>
      <div class="card-body">
        <div class="list-group list-group-flush">
          <div *ngFor="let item of pendingApprovalsList" class="list-group-item">
            <div class="d-flex align-items-start">
              <div class="flex-shrink-0">
                <i [class]="getApprovalTypeIcon(item.type) + ' text-primary fs-4'"></i>
              </div>
              <div class="flex-grow-1 ms-3">
                <h6 class="mb-1">{{ item.type }}</h6>
                <p class="mb-2 text-muted small">{{ item.description }}</p>
                <div class="d-flex justify-content-between align-items-center">
                  <small class="text-muted">{{ item.requestor }} â€¢ {{ item.date }}</small>
                  <div class="btn-group btn-group-sm">
                    <button class="btn btn-success btn-sm" (click)="approveItem(item.id)">
                      <i class="ri-check-line"></i>
                    </button>
                    <button class="btn btn-danger btn-sm" (click)="rejectItem(item.id)">
                      <i class="ri-close-line"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div *ngIf="pendingApprovalsList.length === 0" class="text-center text-muted py-3">
            No pending approvals
          </div>
        </div>
      </div>
    </div>
    
    <!-- Quick Access -->
    <div class="card mt-3">
      <div class="card-header">
        <h4 class="card-title mb-0">Quick Access</h4>
      </div>
      <div class="card-body">
        <div class="d-grid gap-2">
          <button class="btn btn-soft-primary btn-sm" [routerLink]="['/case-management/assignments']">
            <i class="ri-user-add-line me-2"></i>Case Assignments Dashboard
          </button>
          <button class="btn btn-soft-primary btn-sm" [routerLink]="['/case-management/assignments/management']">
            <i class="ri-user-settings-line me-2"></i>Assignment Management
          </button>
          <button class="btn btn-soft-purple btn-sm" [routerLink]="['/case-management/tasks']">
            <i class="ri-task-line me-2"></i>Task Management
          </button>
          <button class="btn btn-soft-info btn-sm" [routerLink]="['/time-tracking/approval']">
            <i class="ri-time-line me-2"></i>Time Approvals
          </button>
          <button class="btn btn-soft-success btn-sm" [routerLink]="['/legal/cases']">
            <i class="ri-briefcase-line me-2"></i>All Cases
          </button>
          <button class="btn btn-soft-warning btn-sm" [routerLink]="['/time-tracking/reports/team']">
            <i class="ri-bar-chart-line me-2"></i>Team Reports
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Department-Specific Content -->
<div class="row" *ngIf="managerType === 'Practice'">
  <!-- Department Cases -->
  <div class="col-12">
    <div class="card">
      <div class="card-header align-items-center d-flex">
        <h4 class="card-title mb-0 flex-grow-1">Department Cases</h4>
        <a href="javascript:void(0);" class="link-primary" (click)="navigateToCases()">View All</a>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover align-middle mb-0">
            <thead>
              <tr>
                <th>Case Number</th>
                <th>Title</th>
                <th>Attorney</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let case of departmentCases">
                <td>
                  <a href="javascript:void(0);" (click)="viewCase(case.id)" class="fw-medium link-primary">
                    {{ case.caseNumber }}
                  </a>
                </td>
                <td>{{ case.title }}</td>
                <td>{{ case.attorney }}</td>
                <td>
                  <span [class]="getCaseStatusClass(case.status)">{{ case.status }}</span>
                </td>
                <td>
                  <button class="btn btn-sm btn-link text-primary" (click)="viewCase(case.id)">
                    <i class="ri-eye-line"></i>
                  </button>
                </td>
              </tr>
              <tr *ngIf="departmentCases.length === 0">
                <td colspan="5" class="text-center text-muted">No cases found</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- IT Manager Specific Content -->
<div class="row" *ngIf="managerType === 'IT'">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h4 class="card-title mb-0">System Health & Resources</h4>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-3" *ngFor="let resource of resourceAllocation">
            <div class="border rounded p-3 text-center">
              <h5 class="mb-1">{{ resource.value }}{{ resource.unit }}</h5>
              <p class="text-muted mb-0">{{ resource.name }}</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- HR Manager Specific Content -->
<div class="row" *ngIf="managerType === 'HR'">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h4 class="card-title mb-0">Staff Management Overview</h4>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-3" *ngFor="let item of staffSchedule">
            <div class="border rounded p-3">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <h5 class="mb-1">{{ item.count }}</h5>
                  <p class="text-muted mb-0">{{ item.name }}</p>
                </div>
                <span class="badge bg-primary-subtle text-primary">{{ item.status }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Finance Manager Specific Content -->
<div class="row" *ngIf="managerType === 'Finance'">
  <div class="col-12">
    <div class="card">
      <div class="card-header align-items-center d-flex">
        <h4 class="card-title mb-0 flex-grow-1">Budget Allocation</h4>
        <a href="javascript:void(0);" class="link-primary" (click)="navigateToBudget()">View Details</a>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead>
              <tr>
                <th>Category</th>
                <th>Amount</th>
                <th>Percentage</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let item of resourceAllocation">
                <td>{{ item.name }}</td>
                <td>${{ (item.value/1000).toFixed(0) }}K</td>
                <td>
                  <div class="progress" style="height: 6px;">
                    <div class="progress-bar bg-primary" [style.width.%]="item.percentage"></div>
                  </div>
                  <small class="text-muted">{{ item.percentage }}%</small>
                </td>
                <td>
                  <span class="badge bg-success-subtle text-success">On Track</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>