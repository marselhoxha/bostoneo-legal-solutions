<!-- Page Title -->
<div class="page-title-box d-sm-flex align-items-center justify-content-between">
  <h4 class="mb-sm-0">Admin Dashboard</h4>
  <div class="page-title-right">
    <ol class="breadcrumb m-0">
      <li class="breadcrumb-item"><a href="javascript: void(0);">Dashboards</a></li>
      <li class="breadcrumb-item active">Admin</li>
    </ol>
  </div>
</div>

<!-- Enhanced Professional Banner -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card border-0 shadow-lg overflow-hidden admin-banner">
      <!-- Animated Background Elements -->
      <div class="banner-bg-elements">
        <div class="bg-element bg-element-1"></div>
        <div class="bg-element bg-element-2"></div>
        <div class="bg-element bg-element-3"></div>
        <div class="bg-element bg-element-4"></div>
      </div>

      <!-- Main Banner Content -->
      <div class="card-body position-relative p-5">
        <div class="row align-items-center">
          <!-- Left Column - Main Content -->
          <div class="col-lg-8">
            <!-- Firm Branding with Enhanced Design -->
            <div class="d-flex align-items-center mb-4 firm-branding">
              <div class="firm-logo-container me-4">
                <div class="firm-logo-wrapper">
                  <div class="logo-glow"></div>
                  <div class="firm-logo">
                    <i class="ri-scales-3-line"></i>
                  </div>
                </div>
              </div>
              <div class="firm-info">
                <h1 class="firm-name mb-2">Bostoneo Legal Solutions</h1>
                <div class="firm-tagline mb-2">
                  <span class="tagline-highlight">Excellence in Legal Services</span>
                  <span class="tagline-separator">â€¢</span>
                  <span class="tagline-text">Professional Dashboard</span>
                </div>
                <div class="firm-credentials">
                  <span class="credential-badge">
                    <i class="ri-shield-check-line me-1"></i>Licensed & Certified
                  </span>
                  <span class="credential-badge">
                    <i class="ri-award-line me-1"></i>25+ Years Experience
                  </span>
                  <span class="credential-badge">
                    <i class="ri-global-line me-1"></i>Boston Metropolitan Area
                  </span>
                </div>
              </div>
            </div>

            <!-- Enhanced Welcome Message -->
            <div class="welcome-section mb-4">
              <div class="welcome-header mb-3">
                <h2 class="welcome-title">
                  Welcome back, <span class="user-name">{{currentUser?.firstName || 'Administrator'}}</span>! 
                  <span class="welcome-emoji">ðŸ‘‹</span>
                </h2>
                <div class="welcome-time">
                  <i class="ri-time-line me-2"></i>
                  <span>Last login: Today at 9:30 AM</span>
                </div>
              </div>
              <p class="welcome-description">
                <i class="ri-dashboard-3-line me-2"></i>
                Comprehensive administrative dashboard with real-time legal practice analytics, case management, and business intelligence insights
              </p>
            </div>

            <!-- Enhanced Quick Actions in Banner -->
            <div class="banner-actions">
              <div class="actions-header mb-3">
                <h6 class="actions-title">
                  <i class="ri-rocket-line me-2"></i>Quick Actions
                </h6>
              </div>
              <div class="actions-grid">
                <a href="/admin/user-roles" class="action-btn action-btn-primary">
                  <div class="action-icon">
                    <i class="ri-user-settings-line"></i>
                  </div>
                  <div class="action-content">
                    <span class="action-label">Manage Users</span>
                    <small class="action-desc">User roles & permissions</small>
                  </div>
                </a>
                <a href="/legal/cases/new" class="action-btn action-btn-success">
                  <div class="action-icon">
                    <i class="ri-add-circle-line"></i>
                  </div>
                  <div class="action-content">
                    <span class="action-label">New Case</span>
                    <small class="action-desc">Create legal case</small>
                  </div>
                </a>
                <a href="/invoices/new" class="action-btn action-btn-info">
                  <div class="action-icon">
                    <i class="ri-bill-line"></i>
                  </div>
                  <div class="action-content">
                    <span class="action-label">New Invoice</span>
                    <small class="action-desc">Generate billing</small>
                  </div>
                </a>
                <a routerLink="/activities" class="action-btn action-btn-warning">
                  <div class="action-icon">
                    <i class="ri-shield-check-line"></i>
                  </div>
                  <div class="action-content">
                    <span class="action-label">Audit Logs</span>
                    <small class="action-desc">System activity</small>
                  </div>
                </a>
              </div>
            </div>
          </div>

          <!-- Right Column - Enhanced Stats Overview -->
          <div class="col-lg-4">
            <div class="stats-overview">
              <div class="stats-header mb-4">
                <h5 class="stats-title">
                  <i class="ri-bar-chart-box-line me-2"></i>Live Overview
                </h5>
                <div class="stats-status">
                  <span class="status-indicator"></span>
                  <span class="status-text">All Systems Operational</span>
                </div>
              </div>
              
              <div class="stats-grid">
                <div class="stat-card stat-card-primary">
                  <div class="stat-icon">
                    <i class="ri-user-line"></i>
                  </div>
                  <div class="stat-content">
                    <h4 class="stat-number">{{getActiveUsersCount()}}</h4>
                    <p class="stat-label">Active Users</p>
                    <div class="stat-trend">
                      <i class="ri-arrow-up-line"></i>
                      <span>+12%</span>
                    </div>
                  </div>
                </div>
                
                <div class="stat-card stat-card-success">
                  <div class="stat-icon">
                    <i class="ri-cpu-line"></i>
                  </div>
                  <div class="stat-content">
                    <h4 class="stat-number">{{getSystemLoad()}}%</h4>
                    <p class="stat-label">System Load</p>
                    <div class="stat-trend">
                      <i class="ri-arrow-down-line"></i>
                      <span>-5%</span>
                    </div>
                  </div>
                </div>
                
                <div class="stat-card stat-card-warning">
                  <div class="stat-icon">
                    <i class="ri-briefcase-line"></i>
                  </div>
                  <div class="stat-content">
                    <h4 class="stat-number">{{activeCases}}</h4>
                    <p class="stat-label">Active Cases</p>
                    <div class="stat-trend">
                      <i class="ri-arrow-up-line"></i>
                      <span>+8%</span>
                    </div>
                  </div>
                </div>
                
                <div class="stat-card stat-card-info">
                  <div class="stat-icon">
                    <i class="ri-team-line"></i>
                  </div>
                  <div class="stat-content">
                    <h4 class="stat-number">{{totalClients}}</h4>
                    <p class="stat-label">Total Clients</p>
                    <div class="stat-trend">
                      <i class="ri-arrow-up-line"></i>
                      <span>+16%</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Practice Summary -->
<div class="row g-4 mb-4">
  <div class="col-xl-12">
    <div class="card border-0 shadow-sm">
      <div class="card-header border-bottom border-light bg-secondary bg-opacity-10">
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <h5 class="card-title mb-1 fw-semibold text-secondary">
              <i class="ri-bar-chart-box-line me-2"></i>Practice Summary
            </h5>
            <p class="text-muted mb-0 fs-13">Key performance indicators and business metrics</p>
          </div>
          <div class="d-flex gap-2">
            <span class="badge bg-success-subtle text-success">
              <i class="ri-check-line me-1"></i>All Systems Online
            </span>
          </div>
        </div>
      </div>
      <div class="card-body p-4">
        <div class="row g-4 text-center">
          <div class="col-md-3">
            <div class="p-3 bg-success-subtle rounded">
              <i class="ri-user-add-line fs-24 text-success mb-2"></i>
              <h5 class="mb-1 text-success">{{totalClients}}</h5>
              <p class="text-muted mb-0 fs-13">Total Clients</p>
              <small class="text-success">+16.2% growth</small>
            </div>
          </div>
          <div class="col-md-3">
            <div class="p-3 bg-warning-subtle rounded">
              <i class="ri-briefcase-line fs-24 text-warning mb-2"></i>
              <h5 class="mb-1 text-warning">{{activeCases}}</h5>
              <p class="text-muted mb-0 fs-13">Active Cases</p>
              <small class="text-warning">+8.5% this quarter</small>
            </div>
          </div>
          <div class="col-md-3">
            <div class="p-3 bg-info-subtle rounded">
              <i class="ri-file-list-line fs-24 text-info mb-2"></i>
              <h5 class="mb-1 text-info">{{totalInvoices}}</h5>
              <p class="text-muted mb-0 fs-13">Total Invoices</p>
              <small class="text-info">${{totalBilled}}K billed</small>
            </div>
          </div>
          <div class="col-md-3">
            <div class="p-3 bg-primary-subtle rounded">
              <i class="ri-team-line fs-24 text-primary mb-2"></i>
              <h5 class="mb-1 text-primary">{{teamMembers}}</h5>
              <p class="text-muted mb-0 fs-13">Team Members</p>
              <small class="text-primary">{{getCaseCompletionRateFormatted()}}% efficiency</small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Live Activity Feed & Performance Analytics -->
<div class="row g-4 mb-4">
                
  <!-- Main Analytics Dashboard -->
  <div class="col-xl-12">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-info bg-opacity-10 border-0">
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <h5 class="card-title mb-1 fw-bold text-primary">
              <i class="ri-line-chart-line me-2"></i>Business Performance
            </h5>
            <p class="text-muted mb-0 fs-13">Revenue trends and case metrics</p>
          </div>
          <div>
            <span class="badge bg-success-subtle text-success">
              <i class="ri-check-line me-1"></i>Live Data
            </span>
      </div>
    </div>
  </div>
      <div class="card-body p-4">
        <apx-chart 
          *ngIf="combinationChart && combinationChart.series"
          [series]="combinationChart.series"
          [chart]="combinationChart.chart"
          [xaxis]="combinationChart.xaxis"
          [yaxis]="combinationChart.yaxis"
          [stroke]="combinationChart.stroke"
          [fill]="combinationChart.fill"
          [markers]="combinationChart.markers"
          [tooltip]="combinationChart.tooltip"
          [legend]="combinationChart.legend"
          [dataLabels]="combinationChart.dataLabels"
          [colors]="combinationChart.colors">
        </apx-chart>
        <div *ngIf="!combinationChart || !combinationChart.series" class="text-center py-4">
          <div class="spinner-border text-primary" role="status"></div>
          <p class="text-muted mt-2 mb-0">Loading analytics...</p>
              </div>
      </div>
                </div>
              </div>
            </div>
            
<!-- Enhanced Live Activity Stream - Beautiful Velzon Design -->
<div class="row g-4 mb-4">
  <div class="col-12">
    <div class="card border-0 shadow-sm activity-feed-enhanced">
      
      <!-- Beautiful Enhanced Header with Better Shimmer and Auto-refresh -->
      <div class="card-header bg-secondary bg-opacity-10 border-0 py-4">
        <div class="row align-items-center g-0">
          <div class="col">
              <div class="d-flex align-items-center">
              <div class="activity-status-icon-enhanced me-3">
                <div class="status-pulse-enhanced"></div>
                <i class="ri-radar-line text-success"></i>
              </div>
              <div class="header-content">
                <div class="d-flex align-items-center gap-3 mb-1">
                  <h5 class="card-title text-secondary mb-0 fw-bold shimmer-text">
                    Live Activity Stream
                  </h5>
                  <span class="activity-status-badge-compact bg-success-subtle text-success">
                    <i class="ri-wifi-line me-1"></i>Real-Time
                </span>
              </div>
                <p class="card-subtitle text-muted mb-0 fs-13">
                  <i class="ri-shield-check-line me-1"></i>
                  Secure audit trail â€¢ End-to-end encrypted â€¢ Auto-refresh every 3s
                </p>
              </div>
            </div>
              </div>
          <div class="col-auto">
            <div class="d-flex align-items-center gap-3">
              <div class="activity-refresh-indicator-enhanced bg-secondary-subtle text-secondary">
                <div class="refresh-spinner-enhanced border-secondary"></div>
                <span class="refresh-text-enhanced">Auto-sync</span>
              </div>
        </div>
      </div>
    </div>
  </div>

      <!-- Enhanced Card Body with Real Data -->
      <div class="card-body activity-body-enhanced p-0">
        <div class="activity-stream-horizontal">
          <div class="activity-ticker-container">
            
            <!-- Loading State -->
            <div *ngIf="activitiesLoading" class="activity-loading-state text-center py-5">
              <div class="spinner-border text-primary mb-3" role="status">
                <span class="visually-hidden">Loading activities...</span>
              </div>
              <h6 class="text-muted mb-2">Loading Recent Activities</h6>
              <p class="text-muted fs-13 mb-0">Fetching latest audit trail data...</p>
            </div>
            
            <!-- No Activities State -->
            <div *ngIf="!activitiesLoading && recentActivities.length === 0" class="activity-empty-state text-center py-5">
              <div class="mb-3">
                <i class="ri-file-list-line fs-2 text-muted"></i>
              </div>
              <h6 class="text-muted mb-2">No Recent Activities</h6>
              <p class="text-muted fs-13 mb-3">No audit activities found. Activities will appear here as they occur.</p>
              <button class="btn btn-soft-primary btn-sm" (click)="manualRefreshActivities()">
                <i class="ri-refresh-line me-1"></i>Refresh
              </button>
            </div>
            
            <!-- Real Activity Items -->
            <ng-container *ngIf="!activitiesLoading && recentActivities.length > 0">
              <div *ngFor="let activity of recentActivities; trackBy: trackByActivityId" 
                   class="activity-card-velzon" 
                   [ngClass]="'activity-type-' + activity.type">
                <div class="activity-header-velzon">
                  <div class="activity-icon-velzon">
                    <i [class]="getEntityIcon(activity.entityType)"></i>
                  </div>
                  <div class="activity-meta-velzon">
                    <div class="d-flex align-items-center justify-content-between mb-2">
                      <h6 class="activity-title-velzon mb-0">{{getActivityTitle(activity)}}</h6>
                      <span [class]="getActionBadgeClass(activity.action)">{{activity.action}}</span>
                    </div>
                    <p class="activity-description-velzon">
                      {{getActivityDescription(activity)}}
                      <span *ngIf="activity.entityId" class="entity-ref ms-1">
                        â€¢ {{getEntityPrefix(activity.entityType)}} #{{activity.entityId}}
                      </span>
                    </p>
                  </div>
                </div>
                <div class="activity-footer-velzon">
                  <span class="activity-time-velzon">{{getTimeAgo(activity.timestamp)}}</span>
                  <span class="activity-badge-velzon" *ngIf="activity.userName && activity.userName !== 'System'">
                    <i class="ri-user-line me-1"></i>{{activity.userName}}
                  </span>
                </div>
              </div>
              
              <!-- Duplicate for seamless scroll -->
              <div *ngFor="let activity of recentActivities; trackBy: trackByActivityId" 
                   class="activity-card-velzon" 
                   [ngClass]="'activity-type-' + activity.type">
                <div class="activity-header-velzon">
                  <div class="activity-icon-velzon">
                    <i [class]="getEntityIcon(activity.entityType)"></i>
                  </div>
                  <div class="activity-meta-velzon">
                    <div class="d-flex align-items-center justify-content-between mb-2">
                      <h6 class="activity-title-velzon mb-0">{{getActivityTitle(activity)}}</h6>
                      <span [class]="getActionBadgeClass(activity.action)">{{activity.action}}</span>
                    </div>
                    <p class="activity-description-velzon">
                      {{getActivityDescription(activity)}}
                      <span *ngIf="activity.entityId" class="entity-ref ms-1">
                        â€¢ {{getEntityPrefix(activity.entityType)}} #{{activity.entityId}}
                      </span>
                    </p>
                  </div>
                </div>
                <div class="activity-footer-velzon">
                  <span class="activity-time-velzon">{{getTimeAgo(activity.timestamp)}}</span>
                  <span class="activity-badge-velzon" *ngIf="activity.userName && activity.userName !== 'System'">
                    <i class="ri-user-line me-1"></i>{{activity.userName}}
                  </span>
                </div>
              </div>
            </ng-container>

            <!-- Enhanced View More Card -->
            <div class="activity-card-velzon activity-more-velzon">
              <div class="more-content-velzon">
                <div class="more-icon-velzon">
                  <i class="ri-arrow-right-line"></i>
                </div>
                <h6 class="more-title-velzon">Comprehensive Audit Trail</h6>
                <p class="more-description-velzon">Access complete activity history, detailed analytics, and advanced filtering options</p>
                <a routerLink="/activities" class="more-link-velzon">
                  <span>Explore Details</span>
                  <i class="ri-external-link-line"></i>
                </a>
              </div>
            </div>

          </div>
        </div>
      </div>
      
      <!-- Beautiful Enhanced Footer -->
      <div class="card-footer activity-footer-enhanced border-0 py-3">
        <div class="row align-items-center g-0">
          <div class="col">
            <div class="d-flex align-items-center gap-4">
              <div class="footer-live-status">
                <div class="live-indicator">
                  <div class="live-dot"></div>
                  <span class="live-text">Live</span>
                </div>
              </div>
              <div class="footer-divider"></div>
              <div class="footer-update-info">
                <i class="ri-time-line text-muted me-1"></i>
                <span class="update-text">Last update: {{getLastUpdateTime()}}</span>
              </div>
            </div>
          </div>
          <div class="col-auto">
            <div class="footer-actions d-flex gap-2">
              <button class="btn btn-soft-secondary btn-sm" (click)="manualRefreshActivities()" title="Refresh Activities">
                <i class="ri-refresh-line me-1"></i>Refresh
              </button>
              <a routerLink="/activities" class="btn btn-soft-primary btn-sm" title="View All Activities">
                <i class="ri-external-link-line me-1"></i>View All
              </a>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Recent Payments Section -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-success bg-opacity-10 border-0 py-3">
        <div class="row align-items-center">
          <div class="col">
            <div class="d-flex align-items-center">
              <div class="me-3">
                <i class="ri-money-dollar-circle-line fs-4 text-success"></i>
              </div>
              <div>
                <h5 class="card-title mb-0 fw-semibold">Recent Payments</h5>
                <p class="text-muted mb-0 fs-13">Latest payment transactions across all invoices</p>
              </div>
            </div>
          </div>
          <div class="col-auto">
            <a routerLink="/invoices" class="btn btn-sm btn-success-subtle">
              <i class="ri-file-list-3-line me-1"></i>View All Invoices
            </a>
          </div>
        </div>
      </div>
      
      <div class="card-body p-0">
        <!-- Loading State -->
        <div *ngIf="paymentsLoading" class="text-center py-5">
          <div class="spinner-border text-success mb-3" role="status">
            <span class="visually-hidden">Loading payments...</span>
          </div>
          <h6 class="text-muted mb-2">Loading Recent Payments</h6>
          <p class="text-muted fs-13 mb-0">Fetching latest payment data...</p>
        </div>
        
        <!-- No Payments State -->
        <div *ngIf="!paymentsLoading && recentPayments.length === 0" class="text-center py-5">
          <div class="mb-3">
            <i class="ri-money-dollar-box-line fs-1 text-muted"></i>
          </div>
          <h6 class="text-muted mb-2">No Recent Payments</h6>
          <p class="text-muted fs-13 mb-0">Payment records will appear here when processed.</p>
        </div>
        
        <!-- Payments Table -->
        <div *ngIf="!paymentsLoading && recentPayments.length > 0" class="table-responsive">
          <table class="table table-hover mb-0">
            <thead class="table-light">
              <tr>
                <th class="border-0">Date</th>
                <th class="border-0">Invoice</th>
                <th class="border-0">Client</th>
                <th class="border-0">Amount</th>
                <th class="border-0">Method</th>
                <th class="border-0">Reference</th>
                <th class="border-0 text-center">Action</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let payment of recentPayments" class="align-middle">
                <td>
                  <div class="d-flex align-items-center">
                    <i class="ri-calendar-line text-muted me-2"></i>
                    <span class="fw-medium">{{ payment.paymentDate | date:'MMM d, y' }}</span>
                  </div>
                </td>
                <td>
                  <span class="badge bg-secondary-subtle text-secondary">
                    #{{ payment.invoiceNumber || 'N/A' }}
                  </span>
                </td>
                <td>
                  <div class="fw-medium">{{ payment.clientName || 'Unknown Client' }}</div>
                </td>
                <td>
                  <div class="d-flex align-items-center">
                    <span class="text-success fw-bold fs-5">${{ payment.amount | number:'1.2-2' }}</span>
                  </div>
                </td>
                <td>
                  <div class="d-flex align-items-center">
                    <i [class]="'fas ' + getPaymentMethodIcon(payment.paymentMethod) + ' text-muted me-2'"></i>
                    <span>{{ payment.paymentMethod }}</span>
                  </div>
                </td>
                <td>
                  <span class="text-muted">{{ payment.referenceNumber || '-' }}</span>
                </td>
                <td class="text-center">
                  <button class="btn btn-sm btn-light" 
                          (click)="viewInvoice(payment.invoiceId)"
                          title="View Invoice">
                    <i class="ri-eye-line"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- KPI Gauges Row -->
<div class="row g-4 mb-4">
  <div class="col-xl-12">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-success bg-opacity-10 border-0">
        <h6 class="card-title mb-0 fw-semibold text-success">
          <i class="ri-speedometer-line me-2"></i>Performance KPIs
        </h6>
      </div>
      <div class="card-body p-4">
        <div class="row g-4">
          <div class="col-xl-4">
            <div class="text-center">
              <h6 class="text-muted mb-2 fs-13">Collection Rate</h6>
            <apx-chart 
                *ngIf="successRateGauge && successRateGauge.series"
                [series]="successRateGauge.series"
                [chart]="successRateGauge.chart"
                [plotOptions]="successRateGauge.plotOptions"
                [colors]="successRateGauge.colors"
                [labels]="successRateGauge.labels">
              </apx-chart>
              <div *ngIf="!successRateGauge || !successRateGauge.series" class="text-center py-2">
                <div class="spinner-border spinner-border-sm text-success" role="status"></div>
          </div>
        </div>
      </div>
  <div class="col-xl-4">
            <div class="text-center">
              <h6 class="text-muted mb-2 fs-13">Client Satisfaction</h6>
              <apx-chart 
                *ngIf="satisfactionGauge && satisfactionGauge.series"
                [series]="satisfactionGauge.series"
                [chart]="satisfactionGauge.chart"
                [plotOptions]="satisfactionGauge.plotOptions"
                [colors]="satisfactionGauge.colors"
                [labels]="satisfactionGauge.labels">
              </apx-chart>
              <div *ngIf="!satisfactionGauge || !satisfactionGauge.series" class="text-center py-2">
                <div class="spinner-border spinner-border-sm text-info" role="status"></div>
      </div>
        </div>
      </div>
          <div class="col-xl-4">
            <div class="text-center">
              <h6 class="text-muted mb-2 fs-13">System Efficiency</h6>
              <apx-chart 
                *ngIf="efficiencyGauge && efficiencyGauge.series"
                [series]="efficiencyGauge.series"
                [chart]="efficiencyGauge.chart"
                [plotOptions]="efficiencyGauge.plotOptions"
                [colors]="efficiencyGauge.colors"
                [labels]="efficiencyGauge.labels">
              </apx-chart>
              <div *ngIf="!efficiencyGauge || !efficiencyGauge.series" class="text-center py-2">
                <div class="spinner-border spinner-border-sm text-warning" role="status"></div>
              </div>
              </div>
            </div>
              </div>
              </div>
            </div>
  </div>
</div>

<!-- Secondary Analytics Row -->
<div class="row g-4 mb-4">
  
  <!-- Case Pipeline -->
  <div class="col-xl-4">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-header bg-warning bg-opacity-10 border-0">
        <h6 class="card-title mb-0 fw-semibold text-warning">
          <i class="ri-briefcase-4-line me-2"></i>Case Pipeline
        </h6>
                        </div>
      <div class="card-body p-3">
        <apx-chart 
          *ngIf="funnelChart && funnelChart.series"
          [series]="funnelChart.series"
          [chart]="funnelChart.chart"
          [plotOptions]="funnelChart.plotOptions"
          [colors]="funnelChart.colors"
          [dataLabels]="funnelChart.dataLabels"
          [legend]="funnelChart.legend"
          [tooltip]="funnelChart.tooltip">
        </apx-chart>
        <div *ngIf="!funnelChart || !funnelChart.series" class="text-center py-4">
          <div class="spinner-border text-warning" role="status"></div>
          <p class="text-muted mt-2 mb-0 fs-13">Loading pipeline...</p>
                </div>
                
        <!-- Case Metrics -->
        <div class="mt-3 pt-3 border-top">
          <div class="row text-center g-2">
            <div class="col-4">
              <h6 class="mb-1 fw-semibold text-primary">{{conversionMetrics.newInquiries}}</h6>
              <p class="text-muted mb-0 fs-12">New</p>
                        </div>
            <div class="col-4">
              <h6 class="mb-1 fw-semibold text-success">{{conversionMetrics.casesWon}}</h6>
              <p class="text-muted mb-0 fs-12">Resolved</p>
                      </div>
            <div class="col-4">
              <h6 class="mb-1 fw-semibold text-warning">{{conversionMetrics.conversionRate}}%</h6>
              <p class="text-muted mb-0 fs-12">Success</p>
                    </div>
                      </div>
                      </div>
                    </div>
                  </div>
                </div>
                
  <!-- Revenue by Practice Area - Horizontal Bar Chart -->
  <div class="col-xl-4">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-header bg-info bg-opacity-10 border-0">
        <h6 class="card-title mb-0 fw-semibold text-info">
          <i class="ri-bar-chart-horizontal-line me-2"></i>Revenue by Practice
        </h6>
                        </div>
      <div class="card-body p-3">
        <apx-chart 
          *ngIf="practiceAreaChart && practiceAreaChart.series"
          [series]="practiceAreaChart.series"
          [chart]="practiceAreaChart.chart"
          [plotOptions]="practiceAreaChart.plotOptions"
          [xaxis]="practiceAreaChart.xaxis"
          [yaxis]="practiceAreaChart.yaxis"
          [colors]="practiceAreaChart.colors"
          [dataLabels]="practiceAreaChart.dataLabels"
          [legend]="practiceAreaChart.legend"
          [tooltip]="practiceAreaChart.tooltip">
        </apx-chart>
        <div *ngIf="!practiceAreaChart || !practiceAreaChart.series" class="text-center py-4">
          <div class="spinner-border text-info" role="status"></div>
          <p class="text-muted mt-2 mb-0 fs-13">Loading revenue data...</p>
                </div>
                
        <!-- Revenue Summary -->
        <div class="mt-3 pt-3 border-top text-center">
          <h5 class="mb-1 fw-bold text-dark">${{totalRevenue}}K</h5>
          <p class="text-muted mb-0 fs-13">Total Revenue</p>
          <div class="mt-2">
            <span class="badge bg-success-subtle text-success">
              <i class="ri-arrow-up-line me-1"></i>+12.5%
            </span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
  <!-- Client Distribution -->
  <div class="col-xl-4">
    <div class="card border-0 shadow-sm h-100">
      <div class="card-header bg-secondary bg-opacity-10 border-0">
        <h6 class="card-title mb-0 fw-semibold text-secondary">
          <i class="ri-map-pin-line me-2"></i>Client Distribution
        </h6>
                        </div>
      <div class="card-body p-3">
        <apx-chart 
          *ngIf="clientDistributionChart && clientDistributionChart.series"
          [series]="clientDistributionChart.series"
          [chart]="clientDistributionChart.chart"
          [labels]="clientDistributionChart.labels"
          [colors]="clientDistributionChart.colors"
          [plotOptions]="clientDistributionChart.plotOptions"
          [legend]="clientDistributionChart.legend"
          [tooltip]="clientDistributionChart.tooltip"
          [dataLabels]="clientDistributionChart.dataLabels">
        </apx-chart>
        <div *ngIf="!clientDistributionChart || !clientDistributionChart.series" class="text-center py-4">
          <div class="spinner-border text-secondary" role="status"></div>
          <p class="text-muted mt-2 mb-0 fs-13">Loading distribution...</p>
                </div>
                
        <!-- Geographic Summary -->
        <div class="mt-3 pt-3 border-top">
          <div class="row g-2 text-center">
            <div class="col-6">
              <h6 class="mb-1 fw-semibold">{{geographicData.bostonMetro.percentage}}%</h6>
              <p class="text-muted mb-0 fs-12">Boston Metro</p>
                        </div>
            <div class="col-6">
              <h6 class="mb-1 fw-semibold">{{geographicData.massachusetts.percentage}}%</h6>
              <p class="text-muted mb-0 fs-12">Massachusetts</p>
                      </div>
                    </div>
                      </div>
                      </div>
                    </div>
                  </div>
                </div>
                
<!-- SMS Test Card -->
<div class="row g-4 mb-4">
  <div class="col-xl-6">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-success bg-opacity-10 border-0">
        <h6 class="card-title mb-0 fw-semibold text-success">
          <i class="ri-smartphone-line me-2"></i>SMS Communication Test
        </h6>
      </div>
      <div class="card-body p-4">
        <div class="mb-3">
          <label class="form-label">Phone Number</label>
          <input type="tel" class="form-control" [(ngModel)]="smsTestPhone"
                 placeholder="+1 (555) 123-4567" />
          <small class="text-muted">Enter phone number in any format</small>
        </div>
        <div class="mb-3">
          <label class="form-label">Message</label>
          <textarea class="form-control" [(ngModel)]="smsTestMessage" rows="3"
                    placeholder="Enter your test message here..."></textarea>
        </div>
        <div class="d-flex gap-2">
          <button class="btn btn-success" (click)="sendTestSms()" [disabled]="smsSending">
            <i class="ri-send-plane-line me-1"></i>
            {{ smsSending ? 'Sending...' : 'Send Test SMS' }}
          </button>
          <button class="btn btn-outline-info" (click)="sendTemplatedTestSms()" [disabled]="smsSending">
            <i class="ri-file-text-line me-1"></i>
            Send Template
          </button>
        </div>

        <!-- SMS Result -->
        <div *ngIf="smsResult" class="mt-3 p-3 rounded"
             [ngClass]="smsResult.success ? 'bg-success-subtle' : 'bg-danger-subtle'">
          <div class="d-flex align-items-center">
            <i [ngClass]="smsResult.success ? 'ri-check-circle-line text-success' : 'ri-error-warning-line text-danger'"
               class="fs-20 me-2"></i>
            <div>
              <strong>{{ smsResult.success ? 'SMS Sent Successfully!' : 'SMS Failed' }}</strong>
              <p class="mb-0 small">
                {{ smsResult.success ? 'Message SID: ' + smsResult.messageSid : smsResult.errorMessage }}
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SMS Service Status -->
  <div class="col-xl-6">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-info bg-opacity-10 border-0">
        <h6 class="card-title mb-0 fw-semibold text-info">
          <i class="ri-settings-3-line me-2"></i>Communication Service Status
        </h6>
      </div>
      <div class="card-body p-4">
        <div class="row g-3">
          <div class="col-6">
            <div class="p-3 bg-light rounded text-center">
              <i class="ri-smartphone-line fs-24 mb-2"
                 [ngClass]="smsServiceStatus?.smsEnabled ? 'text-success' : 'text-danger'"></i>
              <h6 class="mb-1">SMS Service</h6>
              <span class="badge" [ngClass]="smsServiceStatus?.smsEnabled ? 'bg-success' : 'bg-danger'">
                {{ smsServiceStatus?.smsEnabled ? 'Active' : 'Inactive' }}
              </span>
            </div>
          </div>
          <div class="col-6">
            <div class="p-3 bg-light rounded text-center">
              <i class="ri-whatsapp-line fs-24 mb-2"
                 [ngClass]="smsServiceStatus?.whatsappEnabled ? 'text-success' : 'text-secondary'"></i>
              <h6 class="mb-1">WhatsApp</h6>
              <span class="badge" [ngClass]="smsServiceStatus?.whatsappEnabled ? 'bg-success' : 'bg-secondary'">
                {{ smsServiceStatus?.whatsappEnabled ? 'Active' : 'Not Configured' }}
              </span>
            </div>
          </div>
          <div class="col-12">
            <div class="p-3 bg-warning-subtle rounded">
              <div class="d-flex justify-content-between align-items-center">
                <div>
                  <i class="ri-error-warning-line text-warning me-2"></i>
                  <span>Failed Messages (Last 30 days)</span>
                </div>
                <span class="badge bg-warning">{{ smsServiceStatus?.failedCount || 0 }}</span>
              </div>
            </div>
          </div>
        </div>
        <button class="btn btn-outline-info btn-sm mt-3" (click)="refreshSmsStatus()">
          <i class="ri-refresh-line me-1"></i>Refresh Status
        </button>
      </div>
    </div>
  </div>
</div>

<!-- System Activity Heatmap -->
<div class="row g-4">
  <div class="col-12">
    <div class="card border-0 shadow-sm">
      <div class="card-header bg-dark bg-opacity-10 border-0">
        <h6 class="card-title mb-0 fw-semibold text-dark">
          <i class="ri-pulse-line me-2"></i>System Activity Heatmap
        </h6>
                        </div>
      <div class="card-body p-4">
        <apx-chart
          *ngIf="heatMapChart && heatMapChart.series"
          [series]="heatMapChart.series"
          [chart]="heatMapChart.chart"
          [plotOptions]="heatMapChart.plotOptions"
          [xaxis]="heatMapChart.xaxis"
          [yaxis]="heatMapChart.yaxis"
          [colors]="heatMapChart.colors"
          [tooltip]="heatMapChart.tooltip">
        </apx-chart>
        <div *ngIf="!heatMapChart || !heatMapChart.series" class="text-center py-4">
          <div class="spinner-border text-dark" role="status"></div>
          <p class="text-muted mt-2 mb-0 fs-13">Loading activity data...</p>
        </div>
      </div>
    </div>
  </div>
</div> 