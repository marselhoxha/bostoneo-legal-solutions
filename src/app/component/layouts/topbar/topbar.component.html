<header id="page-topbar" data-scroll-header >
    <div class="layout-width">
        <div class="navbar-header">
            <div class="d-flex">
                <!-- LOGO -->
                <div class="navbar-brand-box horizontal-logo">
                    <a href="javascript:void(0);" class="logo logo-dark">
                        <span class="logo-sm">
                            <img src="assets/images/bostoneo-logo-1.svg" alt="" height="60">
                        </span>
                        <span class="logo-lg">
                            <img src="assets/images/bostoneo-logo-1.svg" alt="" height="60">
                        </span>
                    </a>

                    <a href="javascript:void(0);" class="logo logo-light">
                        <span class="logo-sm">
                            <img src="assets/images/bostoneo-logo-white-1.svg" alt="" height="60">
                        </span>
                        <span class="logo-lg">
                            <img src="assets/images/bostoneo-logo-white-1.svg" alt="" height="60">
                        </span>
                    </a>
                </div>

                <button type="button" class="btn btn-sm px-3 fs-16 header-item vertical-menu-btn topnav-hamburger material-shadow-none" id="topnav-hamburger-icon" (click)="toggleMobileMenu($event)">
                    <span class="hamburger-icon">
                        <span></span>
                        <span></span>
                        <span></span>
                    </span>
                </button>

               
            </div>

            <div class="d-flex align-items-center">

                <div class="dropdown d-md-none topbar-head-dropdown header-item" ngbDropdown>
                    <button type="button" class="btn btn-icon btn-topbar material-shadow-none btn-ghost-secondary rounded-circle" id="page-header-search-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" ngbDropdownToggle>
                        <i class="bx bx-search fs-22"></i>
                    </button>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0" aria-labelledby="page-header-search-dropdown" ngbDropdownMenu>
                        <form class="p-3">
                            <div class="form-group m-0">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="Search ..." aria-label="Recipient's username">
                                    <button class="btn btn-primary" type="submit"><i class="mdi mdi-magnify"></i></button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>

           
                <div class="dropdown topbar-head-dropdown ms-1 header-item" ngbDropdown>
                    <button type="button" class="btn btn-icon btn-topbar material-shadow-none btn-ghost-secondary rounded-circle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" ngbDropdownToggle>
                        <i class='bx bx-category-alt fs-22'></i>
                    </button>
                    <div class="dropdown-menu dropdown-menu-lg p-0 dropdown-menu-end" ngbDropdownMenu>
                        <div class="p-3 border-top-0 border-start-0 border-end-0 border-dashed border">
                            <div class="row align-items-center">
                                <div class="col">
                                    <h6 class="m-0 fw-semibold fs-15"> Web Apps </h6>
                                </div>
                                <div class="col-auto">
                                    <a href="javascript:void(0);" class="btn btn-sm btn-soft-info"> View All Apps
                                        <i class="ri-arrow-right-s-line align-middle"></i></a>
                                </div>
                            </div>
                        </div>

                        <div class="p-2">
                            <div class="row g-0">
                                <div class="col">
                                    <a class="dropdown-icon-item" href="javascript:void(0);">
                                        <img src="assets/images/brands/github.png" alt="Github">
                                        <span>GitHub</span>
                                    </a>
                                </div>
                                <div class="col">
                                    <a class="dropdown-icon-item" href="javascript:void(0);">
                                        <img src="assets/images/brands/bitbucket.png" alt="bitbucket">
                                        <span>Bitbucket</span>
                                    </a>
                                </div>
                                <div class="col">
                                    <a class="dropdown-icon-item" href="javascript:void(0);">
                                        <img src="assets/images/brands/dribbble.png" alt="dribbble">
                                        <span>Dribbble</span>
                                    </a>
                                </div>
                            </div>

                            <div class="row g-0">
                                <div class="col">
                                    <a class="dropdown-icon-item" href="javascript:void(0);">
                                        <img src="assets/images/brands/dropbox.png" alt="dropbox">
                                        <span>Dropbox</span>
                                    </a>
                                </div>
                                <div class="col">
                                    <a class="dropdown-icon-item" href="javascript:void(0);">
                                        <img src="assets/images/brands/mail_chimp.png" alt="mail_chimp">
                                        <span>Mail Chimp</span>
                                    </a>
                                </div>
                                <div class="col">
                                    <a class="dropdown-icon-item" href="javascript:void(0);">
                                        <img src="assets/images/brands/slack.png" alt="slack">
                                        <span>Slack</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

              

                <div class="ms-1 header-item d-none d-sm-flex">
                    <button type="button" class="btn btn-icon btn-topbar material-shadow-none btn-ghost-secondary rounded-circle" data-toggle="fullscreen" (click)="fullscreen()">
                        <i class='bx bx-fullscreen fs-22'></i>
                    </button>
                </div>

                <div class="ms-1 header-item d-none d-sm-flex">
                    <button
                      type="button"
                      class="btn btn-icon btn-topbar material-shadow-none btn-ghost-secondary rounded-circle light-dark-mode"
                      (click)="toggleTheme()" 
                    >
                      <i class='bx bx-moon fs-22'></i>
                      <i class='bx bx-sun fs-22'></i>
                    </button>
                  </div>
                  
                <!-- Notification Dropdown -->
                <div class="dropdown ms-sm-3 header-item" ngbDropdown #notificationDropdown="ngbDropdown" display="dynamic" [placement]="'bottom-end'" (openChange)="onNotificationDropdownToggle($event)">
                    <button type="button" class="btn btn-icon btn-topbar material-shadow-none btn-ghost-secondary rounded-circle position-relative notification-bell" 
                            ngbDropdownToggle 
                            id="page-header-notifications-dropdown" 
                            [ngClass]="{'has-new-notifications': hasNewNotifications}" 
                            aria-haspopup="true" 
                            aria-expanded="false"
                            (click)="$event.stopPropagation()">
                        <i class="bx bx-bell fs-22"></i>
                        <span *ngIf="unreadNotificationCount > 0" class="position-absolute topbar-badge fs-10 translate-middle badge rounded-pill bg-danger">
                            {{ unreadNotificationCount || '' }}
                            <span class="visually-hidden">unread notifications</span>
                        </span>
                    </button>
                    <div class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0 custom-notification-dropdown overflow-hidden" ngbDropdownMenu aria-labelledby="page-header-notifications-dropdown">
                        <div class="dropdown-head bg-primary bg-pattern rounded-top">
                            <div class="p-3">
                                <div class="row align-items-center">
                                    <div class="col">
                                        <h6 class="m-0 fs-16 fw-semibold text-white">
                                            <i class="bx bx-bell-ring me-2"></i>Notifications
                                        </h6>
                                    </div>
                                    <div class="col-auto dropdown-tabs">
                                        <span class="badge bg-light-subtle text-dark fs-13" *ngIf="pushNotifications.length > 0">
                                            {{ pushNotifications.length }} <span class="text-nowrap">{{ hasUnreadNotifications() ? '(' + getUnreadCount() + ' new)' : '' }}</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="tab-content position-relative">
                            <div class="tab-pane fade show active py-2 ps-2" id="all-noti-tab" role="tabpanel">
                                <div class="notification-list-scroll" style="max-height: 300px;" data-simplebar>
                                    <!-- Empty state with improved styling -->
                                    <div *ngIf="pushNotifications.length === 0" class="text-center p-4 empty-notification">
                                        <div class="avatar-md mx-auto mb-4">
                                            <div class="avatar-title bg-light-subtle text-primary rounded-circle fs-24">
                                                <i class="bx bx-bell-off"></i>
                                            </div>
                                        </div>
                                        <h5 class="mb-1 font-size-16">No Notifications</h5>
                                        <p class="text-muted mb-0">You have no notifications at the moment.</p>
                                    </div>

                                    <!-- Notification items with improved styling -->
                                    <div *ngFor="let notification of pushNotifications; let i = index" 
                                         class="text-reset notification-item d-block p-2 position-relative" 
                                         [ngClass]="{'bg-light-subtle': !notification.read}"
                                         [style]="{'--index': i}"
                                         (click)="onNotificationClick(notification)">
                                        <div class="d-flex">
                                            <div class="flex-shrink-0 me-3">
                                                <div class="avatar-xs rounded-circle" [ngClass]="getNotificationIconClass(notification)">
                                                    <i [ngClass]="getNotificationIcon(notification)"></i>
                                                </div>
                                            </div>
                                            <div class="flex-grow-1">
                                                <h6 class="mb-1 fs-14 notification-title" [ngClass]="!notification.read ? 'fw-semibold' : ''">
                                                    {{ notification.title }}
                                                </h6>
                                                <div class="font-size-13 notification-text">
                                                    <p class="mb-1" [ngClass]="!notification.read ? 'notification-text-unread' : ''">
                                                        {{ notification.body }}
                                                    </p>
                                                </div>
                                                <p class="mb-0 font-size-11 text-muted">
                                                    <i class="mdi mdi-clock-outline"></i>
                                                    <span>{{ notification.timestamp | date:'shortTime' }}</span>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="p-2 mt-2 border-top">
                            <div class="row g-2">
                                <div class="col">
                                    <button type="button" (click)="markAllAsRead()" class="btn btn-sm btn-light" *ngIf="hasUnreadNotifications()">
                                        <i class="ri-check-double-line align-bottom"></i> Mark All Read
                                    </button>
                                    <button type="button" (click)="sendTestNotification()" class="btn btn-sm btn-light" *ngIf="!hasUnreadNotifications()">
                                        <i class="ri-notification-3-line align-bottom"></i> Test
                                    </button>
                                    <button type="button" (click)="clearAllNotifications()" class="btn btn-sm btn-light ms-2" *ngIf="pushNotifications.length > 0">
                                        <i class="ri-delete-bin-line align-bottom"></i> Clear
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div *ngIf="user$ | async as user" class="dropdown ms-sm-3 header-item topbar-user" ngbDropdown>
                    <button type="button" class="btn material-shadow-none" id="page-header-user-dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false" ngbDropdownToggle>
                        <span class="d-flex align-items-center">
                            <img class="rounded-circle header-profile-user" [src]="user?.imageUrl" alt="Header Avatar">                            <span class="text-start ms-xl-2">
                                <span class="d-none d-xl-inline-block ms-1 fw-medium user-name-text">{{ user.firstName }} {{ user.lastName }}
                                   </span>
                                <span class="d-none d-xl-block ms-1 fs-12 user-name-sub-text">{{ user.title }}
                                   </span>
                            </span>
                        </span>
                    </button>
                    <div class="dropdown-menu dropdown-menu-end" ngbDropdownMenu>
                        <!-- item-->
                        <a class="dropdown-item" routerLink="/profile"><i class="mdi mdi-account-circle text-muted fs-16 align-middle me-1"></i> <span class="align-middle">Profile</span></a>
                        <a class="dropdown-item" routerLink="/"><i class="mdi mdi-calendar-check-outline text-muted fs-16 align-middle me-1"></i> <span class="align-middle">Taskboard</span></a>
                        <a class="dropdown-item" routerLink="/"><i class="mdi mdi-lifebuoy text-muted fs-16 align-middle me-1"></i> <span class="align-middle">Help</span></a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" routerLink="/"><i class="mdi mdi-wallet text-muted fs-16 align-middle me-1"></i> <span class="align-middle">Balance : <b>$5971.67</b></span></a>
                        <a class="dropdown-item" routerLink="/"><span class="badge bg-success-subtle text-success mt-1 float-end">New</span><i class="mdi mdi-cog-outline text-muted fs-16 align-middle me-1"></i> <span class="align-middle">Settings</span></a>
                        <a class="dropdown-item" routerLink="/"><i class="mdi mdi-lock text-muted fs-16 align-middle me-1"></i> <span class="align-middle">Lock screen</span></a>
                        <a class="dropdown-item" href="javascript: void(0);" (click)="logOut()"><i class="mdi mdi-logout text-muted fs-16 align-middle me-1"></i> <span class="align-middle" data-key="t-logout">Logout</span></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- removeNotificationModal -->
<ng-template #removenotification let-modal>
    <div class="modal-content border-0">
        <div class="modal-header p-3" [ngClass]="{'bg-primary-subtle': activeNotification?.type === 'default', 
                          'bg-info-subtle': activeNotification?.type === 'case',
                          'bg-warning-subtle': activeNotification?.type === 'deadline',
                          'bg-success-subtle': activeNotification?.type === 'document',
                          'bg-danger-subtle': activeNotification?.type === 'alert',
                          'bg-purple-subtle': activeNotification?.type === 'court'}">
            <div class="d-flex align-items-center">
                <div class="notification-icon me-3 rounded-circle p-2 d-flex align-items-center justify-content-center" style="width: 45px; height: 45px;" 
                     [ngClass]="{'bg-primary': activeNotification?.type === 'default', 
                              'bg-info': activeNotification?.type === 'case',
                              'bg-warning': activeNotification?.type === 'deadline',
                              'bg-success': activeNotification?.type === 'document',
                              'bg-danger': activeNotification?.type === 'alert',
                              'bg-purple': activeNotification?.type === 'court'}">
                    <i class="text-white" [ngClass]="getNotificationIcon(activeNotification)"></i>
                </div>
                <div>
                    <h5 class="modal-title fw-semibold mb-0" [ngClass]="{'text-primary': activeNotification?.type === 'default', 
                                 'text-info': activeNotification?.type === 'case',
                                 'text-warning': activeNotification?.type === 'deadline',
                                 'text-success': activeNotification?.type === 'document',
                                 'text-danger': activeNotification?.type === 'alert',
                                 'text-purple': activeNotification?.type === 'court'}">
                        {{ activeNotification?.title || 'Notification Details' }}
                    </h5>
                </div>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="NotificationModalbtn-close" (click)="modal.dismiss('Cross click')"></button>
        </div>
        <div class="modal-body p-4">
            <div class="notification-details">
                <div class="notification-content mb-4" *ngIf="activeNotification">
                    <!-- Priority badge -->
                    <div class="mb-4" *ngIf="activeNotification.data?.priority === 'high'">
                        <div class="d-flex align-items-center p-2 bg-danger-subtle text-danger rounded">
                            <i class="bx bx-error-circle fs-22 text-danger me-2"></i>
                            <div>
                                <h6 class="fs-15 fw-semibold text-danger mb-0">High Priority Notification</h6>
                                <p class="text-muted mb-0 fs-13">This notification requires immediate attention</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Main notification body content -->
                    <div class="p-3 border-start border-4 rounded bg-light-subtle mb-4 position-relative shadow-sm"
                         [ngClass]="{'border-primary': activeNotification?.type === 'default', 
                                     'border-info': activeNotification?.type === 'case',
                                     'border-warning': activeNotification?.type === 'deadline',
                                     'border-success': activeNotification?.type === 'document',
                                     'border-danger': activeNotification?.type === 'alert',
                                     'border-purple': activeNotification?.type === 'court'}">
                        <p class="mb-0 fs-15 lh-base">{{ activeNotification.body }}</p>
                    </div>
                    
                    <!-- Time info -->
                    <div class="d-flex align-items-center mb-4 p-3 rounded bg-light-subtle border shadow-sm">
                        <div class="avatar-xs me-3 flex-shrink-0 rounded-circle bg-primary-subtle text-primary">
                            <i class="bx bx-time fs-16"></i>
                        </div>
                        <div class="flex-grow-1">
                            <h6 class="mb-1 fs-14 fw-medium">Received</h6>
                            <p class="text-muted mb-0 fs-13">
                                {{ activeNotification.timestamp | date:'EEEE, MMMM d, y, h:mm a' }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-light" data-bs-dismiss="modal" (click)="modal.dismiss('Close')">
                <i class="ri-close-line me-1 align-middle"></i> Close
            </button>
            <button type="button" class="btn btn-primary" *ngIf="activeNotification?.data?.url" (click)="modal.close('Navigate')">
                <i class="bx bx-link-external me-1 align-middle"></i> Open Related Item
            </button>
        </div>
    </div>
</ng-template>