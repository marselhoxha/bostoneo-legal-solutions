<!-- Header Section -->
<div class="row">
  <div class="col-12">
    <div class="page-title-box d-sm-flex align-items-center justify-content-between">
      <h4 class="mb-sm-0">
        <i class="ri-file-list-3-line me-2 text-primary"></i>
        {{ selectedPracticeArea ? selectedPracticeArea + ' Forms' : 'Legal Intake Forms' }}
      </h4>
      
      <div class="page-title-right">
        <ol class="breadcrumb m-0">
          <li class="breadcrumb-item"><a href="/">Home</a></li>
          <li class="breadcrumb-item active">
            {{ selectedPracticeArea || 'Intake Forms' }}
          </li>
        </ol>
      </div>
    </div>
  </div>
</div>

<!-- Welcome Banner -->
<div class="row mb-4" *ngIf="!selectedPracticeArea">
  <div class="col-12">
    <div class="card shadow-sm border-0 bg-gradient-primary">
      <div class="card-body p-4">
        <div class="row align-items-center">
          <div class="col-md-8">
            <h3 class="text-white mb-2">
              <i class="ri-scales-3-line me-2"></i>
              Welcome to Our Legal Services
            </h3>
            <p class="text-white-50 mb-3 fs-15">
              Get expert legal assistance by filling out our intake forms. Choose from our specialized practice areas below to get started with your consultation.
            </p>
            <div class="d-flex gap-2">
              <span class="badge bg-white bg-opacity-20 text-white fs-13">
                <i class="ri-shield-check-line me-1"></i>Confidential
              </span>
              <span class="badge bg-white bg-opacity-20 text-white fs-13">
                <i class="ri-time-line me-1"></i>Fast Response
              </span>
              <span class="badge bg-white bg-opacity-20 text-white fs-13">
                <i class="ri-user-star-line me-1"></i>Expert Attorneys
              </span>
            </div>
          </div>
          <div class="col-md-4 text-center">
            <div class="avatar-xl mx-auto">
              <div class="avatar-title rounded-circle bg-white bg-opacity-20 text-white">
                <i class="ri-briefcase-4-line display-6"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Practice Area Filter -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-header bg-light-subtle border-bottom-dashed py-3">
        <div class="d-flex align-items-center justify-content-between">
          <h5 class="card-title mb-0">
            <i class="ri-filter-3-line me-2 text-primary"></i>Practice Areas
          </h5>
          <button class="btn btn-soft-secondary btn-sm" 
                  *ngIf="selectedPracticeArea"
                  (click)="selectPracticeArea('')">
            <i class="ri-close-line me-1"></i>Clear Filter
          </button>
        </div>
      </div>
      <div class="card-body p-4">
        <div class="row g-3">
          <div class="col-lg-2 col-md-4 col-sm-6" *ngFor="let area of practiceAreas">
            <div class="card border h-100 cursor-pointer practice-area-card"
                 [class.border-primary]="selectedPracticeArea === area"
                 [class.bg-primary-subtle]="selectedPracticeArea === area"
                 (click)="selectPracticeArea(area)">
              <div class="card-body text-center p-3">
                <div class="avatar-sm mx-auto mb-3">
                  <div class="avatar-title rounded-circle"
                       [ngClass]="'bg-' + getPracticeAreaConfig(area).color + '-subtle text-' + getPracticeAreaConfig(area).color">
                    <i [ngClass]="getPracticeAreaConfig(area).icon" class="fs-18"></i>
                  </div>
                </div>
                <h6 class="mb-2 fw-semibold">{{ area }}</h6>
                <p class="text-muted mb-0 fs-12">{{ getPracticeAreaConfig(area).description }}</p>
                <div class="mt-2">
                  <span class="badge bg-light text-muted fs-11">
                    {{ getFormsByPracticeArea(area).length }} forms
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="row" *ngIf="isLoading">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-body text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading forms...</span>
        </div>
        <p class="mt-3 text-muted">Loading available forms...</p>
      </div>
    </div>
  </div>
</div>

<!-- Error State -->
<div class="row" *ngIf="error && !isLoading">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-body py-5">
        <div class="alert alert-danger mb-0">
          <div class="d-flex align-items-center">
            <i class="ri-error-warning-line me-3 fs-20"></i>
            <div class="flex-grow-1">
              <h6 class="mb-1">Error Loading Forms</h6>
              <p class="mb-0">{{ error }}</p>
            </div>
            <button class="btn btn-soft-danger btn-sm" (click)="loadForms()">
              <i class="ri-refresh-line me-1"></i>Retry
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Forms List -->
<div class="row" *ngIf="!isLoading && !error">
  <!-- Grouped by Practice Area -->
  <div *ngFor="let practiceArea of getGroupedForms() | keyvalue" class="col-12 mb-4">
    <div class="card shadow-sm">
      <div class="card-header bg-light-subtle border-bottom-dashed py-3">
        <div class="d-flex align-items-center">
          <div class="avatar-sm me-3">
            <div class="avatar-title rounded-circle"
                 [ngClass]="'bg-' + getPracticeAreaConfig(practiceArea.key).color + '-subtle text-' + getPracticeAreaConfig(practiceArea.key).color">
              <i [ngClass]="getPracticeAreaConfig(practiceArea.key).icon" class="fs-18"></i>
            </div>
          </div>
          <div class="flex-grow-1">
            <h5 class="card-title mb-0 fw-semibold">{{ practiceArea.key }}</h5>
            <p class="text-muted mb-0 fs-13">{{ getPracticeAreaConfig(practiceArea.key).description }}</p>
          </div>
          <span class="badge bg-primary fs-12">
            {{ practiceArea.value.length }} forms
          </span>
        </div>
      </div>
      <div class="card-body p-4">
        <div class="row g-4">
          <div class="col-lg-6" *ngFor="let form of practiceArea.value">
            <div class="card border h-100 form-card cursor-pointer" (click)="openForm(form)">
              <div class="card-body p-4">
                <div class="d-flex align-items-start">
                  <div class="flex-shrink-0">
                    <div class="avatar-md rounded-circle bg-primary bg-opacity-10 p-2">
                      <div class="avatar-title text-primary rounded-circle bg-transparent">
                        <i class="ri-file-text-line fs-2"></i>
                      </div>
                    </div>
                  </div>
                  <div class="flex-grow-1 ms-3">
                    <h6 class="mb-2 fw-semibold">{{ form.name }}</h6>
                    <p class="text-muted mb-3 fs-14" *ngIf="form.description">
                      {{ form.description }}
                    </p>
                    
                    <!-- Form Stats -->
                    <div class="d-flex gap-3 mb-3">
                      <div class="d-flex align-items-center text-muted fs-13">
                        <i class="ri-user-line me-1"></i>
                        <span>{{ form.submissionCount || 0 }} submissions</span>
                      </div>
                      <div class="d-flex align-items-center text-muted fs-13" *ngIf="form.conversionRate">
                        <i class="ri-arrow-up-line me-1"></i>
                        <span>{{ (form.conversionRate * 100).toFixed(1) }}% conversion</span>
                      </div>
                    </div>

                    <!-- Action Button -->
                    <div class="d-flex align-items-center justify-content-between">
                      <span class="badge bg-success-subtle text-success fs-12">
                        <i class="ri-shield-check-line me-1"></i>Secure & Confidential
                      </span>
                      <button class="btn btn-primary btn-sm waves-effect waves-light">
                        <i class="ri-arrow-right-line me-1"></i>Start Form
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="col-12" *ngIf="forms.length === 0 && !isLoading && !error">
    <div class="card shadow-sm">
      <div class="card-body text-center py-5">
        <div class="avatar-xl mx-auto mb-4">
          <div class="avatar-title rounded-circle bg-soft-secondary text-secondary">
            <i class="ri-file-list-3-line display-6"></i>
          </div>
        </div>
        <h5 class="mb-3">No Forms Available</h5>
        <p class="text-muted mb-4 mx-auto" style="max-width: 400px;">
          {{ selectedPracticeArea 
            ? 'No intake forms are currently available for ' + selectedPracticeArea + '. Please check other practice areas or contact us directly.'
            : 'No intake forms are currently available. Please contact our office for assistance.' }}
        </p>
        <div class="d-flex gap-2 justify-content-center">
          <button class="btn btn-soft-primary" (click)="selectPracticeArea('')" *ngIf="selectedPracticeArea">
            <i class="ri-arrow-left-line me-1"></i>View All Areas
          </button>
          <a href="tel:+1-555-0123" class="btn btn-primary">
            <i class="ri-phone-line me-1"></i>Call Us
          </a>
        </div>
      </div>
    </div>
  </div>
</div>