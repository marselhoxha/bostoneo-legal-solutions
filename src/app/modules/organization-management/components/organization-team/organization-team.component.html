<div class="team-container">
  <!-- Search Bar -->
  <div class="d-flex align-items-center justify-content-between mb-4 flex-wrap gap-3">
    <div class="search-box">
      <i class="ri-search-line search-icon"></i>
      <input type="text"
             class="form-control"
             placeholder="Search team members..."
             [ngModel]="searchQuery"
             (ngModelChange)="onSearch($event)">
    </div>
    <div class="text-muted fs-13">
      <span *ngIf="totalElements > 0">{{ totalElements }} team member{{ totalElements !== 1 ? 's' : '' }}</span>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="text-muted mt-2">Loading team members...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && teamMembers.length === 0" class="text-center py-5">
    <div class="avatar-lg mx-auto mb-3">
      <span class="avatar-title bg-primary-subtle text-primary rounded-circle fs-24">
        <i class="ri-user-line"></i>
      </span>
    </div>
    <h5 class="text-muted">No Team Members</h5>
    <p class="text-muted mb-0">This organization doesn't have any team members yet.</p>
  </div>

  <!-- Team Members Table -->
  <div class="table-responsive" *ngIf="!isLoading && teamMembers.length > 0">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th class="cursor-pointer" (click)="onSort('firstName')">
            Team Member <i [class]="getSortIcon('firstName')"></i>
          </th>
          <th class="cursor-pointer" (click)="onSort('email')">
            Email <i [class]="getSortIcon('email')"></i>
          </th>
          <th>Role</th>
          <th>Status</th>
          <th class="cursor-pointer" (click)="onSort('createdAt')">
            Joined <i [class]="getSortIcon('createdAt')"></i>
          </th>
          <th class="text-end">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let member of filteredMembers">
          <td>
            <div class="d-flex align-items-center gap-3">
              <div class="avatar-sm flex-shrink-0">
                <img *ngIf="member.imageUrl" [src]="member.imageUrl | imageUrl" alt="" class="rounded-circle" style="width: 36px; height: 36px; object-fit: cover;" (error)="$event.target.src='assets/images/users/default-avatar.jpg'">
                <span *ngIf="!member.imageUrl" class="avatar-title rounded-circle" [ngClass]="'bg-' + getAvatarColor(member) + '-subtle text-' + getAvatarColor(member)">
                  {{ getMemberInitials(member) }}
                </span>
              </div>
              <div>
                <h6 class="mb-0 fs-14">{{ getMemberFullName(member) }}</h6>
                <span class="text-muted fs-12" *ngIf="member.phone">{{ member.phone }}</span>
              </div>
            </div>
          </td>
          <td>
            <span class="text-muted">{{ member.email }}</span>
          </td>
          <td>
            <span class="badge rounded-pill fs-11" [ngClass]="getRoleBadgeClass(member.roleName)">
              {{ member.roleName || 'USER' }}
            </span>
          </td>
          <td>
            <span class="badge rounded-pill" [ngClass]="member.enabled !== false ? 'bg-success-subtle text-success' : 'bg-danger-subtle text-danger'">
              <i [class]="member.enabled !== false ? 'ri-checkbox-circle-line' : 'ri-close-circle-line'" class="me-1"></i>
              {{ member.enabled !== false ? 'Active' : 'Inactive' }}
            </span>
          </td>
          <td>
            <span class="text-muted fs-13" *ngIf="member.createdAt">
              {{ member.createdAt | date:'mediumDate' }}
            </span>
            <span class="text-muted fs-13" *ngIf="!member.createdAt">-</span>
          </td>
          <td class="text-end">
            <div ngbDropdown class="dropdown" container="body">
              <button class="btn btn-soft-secondary btn-sm" ngbDropdownToggle>
                <i class="ri-more-2-fill"></i>
              </button>
              <div ngbDropdownMenu class="dropdown-menu-end">
                <a ngbDropdownItem (click)="changeRole(member)" class="cursor-pointer">
                  <i class="ri-shield-user-line me-2 text-info"></i>Change Role
                </a>
                <div class="dropdown-divider"></div>
                <a ngbDropdownItem (click)="removeMember(member)" class="cursor-pointer text-danger">
                  <i class="ri-user-unfollow-line me-2"></i>Remove from Org
                </a>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div *ngIf="!isLoading && totalPages > 1" class="d-flex align-items-center justify-content-between mt-4">
    <div class="text-muted fs-13">
      Showing {{ currentPage * pageSize + 1 }} - {{ Math.min((currentPage + 1) * pageSize, totalElements) }} of {{ totalElements }}
    </div>
    <nav>
      <ul class="pagination pagination-sm mb-0">
        <li class="page-item" [class.disabled]="currentPage === 0">
          <a class="page-link" (click)="currentPage > 0 && onPageChange(currentPage - 1)">
            <i class="ri-arrow-left-s-line"></i>
          </a>
        </li>
        <li class="page-item" *ngFor="let page of pageNumbers" [class.active]="page === currentPage">
          <a class="page-link" (click)="onPageChange(page)">{{ page + 1 }}</a>
        </li>
        <li class="page-item" [class.disabled]="currentPage >= totalPages - 1">
          <a class="page-link" (click)="currentPage < totalPages - 1 && onPageChange(currentPage + 1)">
            <i class="ri-arrow-right-s-line"></i>
          </a>
        </li>
      </ul>
    </nav>
  </div>
</div>
