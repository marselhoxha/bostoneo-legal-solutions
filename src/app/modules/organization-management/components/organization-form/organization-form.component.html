<div class="container-fluid">
  <!-- Page Header -->
  <div class="row">
    <div class="col-12">
      <div class="page-header-wrapper">
        <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
          <div>
            <div class="text-muted fs-11 fw-semibold letter-spacing text-uppercase mb-1">Administration</div>
            <h4 class="mb-0">{{ isEditMode ? 'Edit Organization' : 'Create Organization' }}</h4>
          </div>
          <div class="d-flex align-items-center gap-2">
            <button type="button" class="btn btn-soft-secondary" (click)="cancel()">
              <i class="ri-arrow-left-line me-1"></i>Back to List
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-grow text-primary" role="status" style="width: 3rem; height: 3rem;"></div>
    <h5 class="mt-4">Loading Organization</h5>
    <p class="text-muted">Fetching organization data...</p>
  </div>

  <!-- Form -->
  <div *ngIf="!isLoading" style="margin-bottom: 60px;">
    <form [formGroup]="organizationForm" (ngSubmit)="onSubmit()">
      <div class="row">
        <!-- Main Content -->
        <div class="col-lg-8">
          <!-- Basic Information Card -->
          <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-transparent border-bottom">
              <h6 class="mb-0 fw-semibold">
                <i class="ri-building-line me-2 text-primary"></i>Basic Information
              </h6>
            </div>
            <div class="card-body">
              <div class="row g-3">
                <div class="col-md-6">
                  <label class="form-label" for="name">Organization Name <span class="text-danger">*</span></label>
                  <input type="text" class="form-control" id="name" formControlName="name"
                         placeholder="Enter organization name"
                         [ngClass]="{'is-invalid': isFieldInvalid('name')}">
                  <div class="invalid-feedback" *ngIf="f['name'].errors?.['required']">
                    Organization name is required.
                  </div>
                  <div class="invalid-feedback" *ngIf="f['name'].errors?.['minlength']">
                    Name must be at least 2 characters.
                  </div>
                </div>

                <div class="col-md-6">
                  <label class="form-label" for="slug">Slug <span class="text-danger">*</span></label>
                  <div class="input-group">
                    <input type="text" class="form-control" id="slug" formControlName="slug"
                           placeholder="organization-slug"
                           (blur)="onSlugBlur()"
                           [ngClass]="{'is-invalid': isFieldInvalid('slug') || (!slugAvailable && !checkingSlug && f['slug'].value)}">
                    <span class="input-group-text" *ngIf="checkingSlug">
                      <div class="spinner-border spinner-border-sm" role="status">
                        <span class="visually-hidden">Checking...</span>
                      </div>
                    </span>
                    <span class="input-group-text text-success" *ngIf="!checkingSlug && slugAvailable && f['slug'].value">
                      <i class="ri-check-line"></i>
                    </span>
                  </div>
                  <div class="text-danger fs-12 mt-1" *ngIf="!slugAvailable && !checkingSlug && f['slug'].value">
                    This slug is already taken.
                  </div>
                  <div class="form-text">URL-friendly identifier (lowercase, hyphens only)</div>
                </div>

                <div class="col-md-6">
                  <label class="form-label" for="email">Email</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="ri-mail-line"></i></span>
                    <input type="email" class="form-control" id="email" formControlName="email"
                           placeholder="contact@organization.com"
                           [ngClass]="{'is-invalid': isFieldInvalid('email')}">
                  </div>
                  <div class="invalid-feedback" *ngIf="f['email'].errors?.['email']">
                    Please enter a valid email address.
                  </div>
                </div>

                <div class="col-md-6">
                  <label class="form-label" for="phone">Phone</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="ri-phone-line"></i></span>
                    <input type="text" class="form-control" id="phone" formControlName="phone"
                           placeholder="+1 (555) 123-4567">
                  </div>
                </div>

                <div class="col-md-6">
                  <label class="form-label" for="website">Website</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="ri-global-line"></i></span>
                    <input type="text" class="form-control" id="website" formControlName="website"
                           placeholder="https://www.organization.com">
                  </div>
                </div>

                <div class="col-md-6">
                  <label class="form-label" for="logoUrl">Logo URL</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="ri-image-line"></i></span>
                    <input type="text" class="form-control" id="logoUrl" formControlName="logoUrl"
                           placeholder="https://example.com/logo.png">
                  </div>
                </div>

                <div class="col-12">
                  <label class="form-label" for="address">Address</label>
                  <div class="input-group">
                    <span class="input-group-text"><i class="ri-map-pin-line"></i></span>
                    <textarea class="form-control" id="address" formControlName="address" rows="2"
                              placeholder="Enter organization address"></textarea>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Notification Preferences Card -->
          <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-transparent border-bottom">
              <h6 class="mb-0 fw-semibold">
                <i class="ri-notification-3-line me-2 text-info"></i>Notification Preferences
              </h6>
            </div>
            <div class="card-body">
              <h6 class="text-muted text-uppercase fs-11 mb-3">Communication Channels</h6>
              <div class="row g-3 mb-4">
                <div class="col-md-4">
                  <div class="notification-toggle p-3 border rounded"
                       [class.active]="f['emailEnabled'].value"
                       (click)="toggleNotification('emailEnabled')">
                    <div class="d-flex align-items-center justify-content-between">
                      <div class="d-flex align-items-center">
                        <i class="ri-mail-line fs-20 me-2" [ngClass]="f['emailEnabled'].value ? 'text-success' : 'text-muted'"></i>
                        <span>Email</span>
                      </div>
                      <div class="form-check form-switch mb-0">
                        <input class="form-check-input" type="checkbox" formControlName="emailEnabled">
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="notification-toggle p-3 border rounded"
                       [class.active]="f['smsEnabled'].value"
                       (click)="toggleNotification('smsEnabled')">
                    <div class="d-flex align-items-center justify-content-between">
                      <div class="d-flex align-items-center">
                        <i class="ri-message-2-line fs-20 me-2" [ngClass]="f['smsEnabled'].value ? 'text-primary' : 'text-muted'"></i>
                        <span>SMS</span>
                      </div>
                      <div class="form-check form-switch mb-0">
                        <input class="form-check-input" type="checkbox" formControlName="smsEnabled">
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="notification-toggle p-3 border rounded"
                       [class.active]="f['whatsappEnabled'].value"
                       (click)="toggleNotification('whatsappEnabled')">
                    <div class="d-flex align-items-center justify-content-between">
                      <div class="d-flex align-items-center">
                        <i class="ri-whatsapp-line fs-20 me-2" [ngClass]="f['whatsappEnabled'].value ? 'text-success' : 'text-muted'"></i>
                        <span>WhatsApp</span>
                      </div>
                      <div class="form-check form-switch mb-0">
                        <input class="form-check-input" type="checkbox" formControlName="whatsappEnabled">
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <hr class="my-4">

              <h6 class="text-muted text-uppercase fs-11 mb-3">Signature Reminders</h6>
              <div class="row g-3">
                <div class="col-md-4">
                  <div class="notification-toggle p-3 border rounded"
                       [class.active]="f['signatureReminderEmail'].value"
                       (click)="toggleNotification('signatureReminderEmail')">
                    <div class="d-flex align-items-center justify-content-between">
                      <div class="d-flex align-items-center">
                        <i class="ri-mail-line me-2" [ngClass]="f['signatureReminderEmail'].value ? 'text-success' : 'text-muted'"></i>
                        <span>Email</span>
                      </div>
                      <div class="form-check form-switch mb-0">
                        <input class="form-check-input" type="checkbox" formControlName="signatureReminderEmail">
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="notification-toggle p-3 border rounded"
                       [class.active]="f['signatureReminderSms'].value"
                       (click)="toggleNotification('signatureReminderSms')">
                    <div class="d-flex align-items-center justify-content-between">
                      <div class="d-flex align-items-center">
                        <i class="ri-message-2-line me-2" [ngClass]="f['signatureReminderSms'].value ? 'text-primary' : 'text-muted'"></i>
                        <span>SMS</span>
                      </div>
                      <div class="form-check form-switch mb-0">
                        <input class="form-check-input" type="checkbox" formControlName="signatureReminderSms">
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="notification-toggle p-3 border rounded"
                       [class.active]="f['signatureReminderWhatsapp'].value"
                       (click)="toggleNotification('signatureReminderWhatsapp')">
                    <div class="d-flex align-items-center justify-content-between">
                      <div class="d-flex align-items-center">
                        <i class="ri-whatsapp-line me-2" [ngClass]="f['signatureReminderWhatsapp'].value ? 'text-success' : 'text-muted'"></i>
                        <span>WhatsApp</span>
                      </div>
                      <div class="form-check form-switch mb-0">
                        <input class="form-check-input" type="checkbox" formControlName="signatureReminderWhatsapp">
                      </div>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <label class="form-label" for="signatureReminderDays">Reminder Days</label>
                  <input type="text" class="form-control" id="signatureReminderDays" formControlName="signatureReminderDays"
                         placeholder="7,3,1">
                  <div class="form-text">Comma-separated days before due date (e.g., 7,3,1)</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
          <!-- Plan Settings Card -->
          <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-transparent border-bottom">
              <h6 class="mb-0 fw-semibold">
                <i class="ri-vip-crown-line me-2 text-warning"></i>Plan Settings
              </h6>
            </div>
            <div class="card-body">
              <!-- Visual Plan Selector -->
              <label class="form-label mb-3">Select Plan Type</label>
              <div class="plan-selector">
                <div class="row g-2">
                  <div class="col-6" *ngFor="let plan of planTypeOptions">
                    <div class="plan-option p-3 border rounded cursor-pointer text-center"
                         [class.selected]="f['planType'].value === plan.value"
                         (click)="selectPlan(plan.value)">
                      <i [class]="plan.icon + ' fs-24 d-block mb-2'" [ngClass]="plan.iconColor"></i>
                      <h6 class="mb-1 fs-13">{{ plan.label }}</h6>
                      <small class="text-muted d-block">{{ plan.description }}</small>
                    </div>
                  </div>
                </div>
              </div>

              <div class="mt-4">
                <label class="form-label" for="planExpiresAt">Plan Expiration Date</label>
                <input type="text" class="form-control" id="planExpiresAt"
                       placeholder="Select date" data-provider="flatpickr">
                <div class="form-text">Leave empty for no expiration</div>
              </div>

              <!-- Plan Features Preview -->
              <div class="mt-4 plan-features-preview">
                <h6 class="text-muted fs-12 text-uppercase mb-3">
                  <i class="ri-list-check me-1"></i>Plan Features
                </h6>
                <div class="features-list p-3 bg-light rounded">
                  <div *ngIf="f['planType'].value === 'FREE'">
                    <div class="feature-item"><i class="ri-user-line text-muted me-2"></i>Up to 3 users</div>
                    <div class="feature-item"><i class="ri-briefcase-line text-muted me-2"></i>Up to 25 cases</div>
                    <div class="feature-item"><i class="ri-hard-drive-line text-muted me-2"></i>1 GB storage</div>
                  </div>
                  <div *ngIf="f['planType'].value === 'STARTER'">
                    <div class="feature-item"><i class="ri-user-line text-info me-2"></i>Up to 10 users</div>
                    <div class="feature-item"><i class="ri-briefcase-line text-info me-2"></i>Up to 100 cases</div>
                    <div class="feature-item"><i class="ri-hard-drive-line text-info me-2"></i>10 GB storage</div>
                    <div class="feature-item"><i class="ri-palette-line text-info me-2"></i>Custom branding</div>
                  </div>
                  <div *ngIf="f['planType'].value === 'PROFESSIONAL'">
                    <div class="feature-item"><i class="ri-user-line text-primary me-2"></i>Up to 50 users</div>
                    <div class="feature-item"><i class="ri-briefcase-line text-primary me-2"></i>Up to 500 cases</div>
                    <div class="feature-item"><i class="ri-hard-drive-line text-primary me-2"></i>50 GB storage</div>
                    <div class="feature-item"><i class="ri-code-line text-primary me-2"></i>API access</div>
                    <div class="feature-item"><i class="ri-bar-chart-line text-primary me-2"></i>Advanced reporting</div>
                  </div>
                  <div *ngIf="f['planType'].value === 'ENTERPRISE'">
                    <div class="feature-item"><i class="ri-user-line text-warning me-2"></i>Unlimited users</div>
                    <div class="feature-item"><i class="ri-briefcase-line text-warning me-2"></i>Unlimited cases</div>
                    <div class="feature-item"><i class="ri-hard-drive-line text-warning me-2"></i>Unlimited storage</div>
                    <div class="feature-item"><i class="ri-customer-service-line text-warning me-2"></i>Priority support</div>
                    <div class="feature-item"><i class="ri-checkbox-circle-line text-warning me-2"></i>All features included</div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Actions Card -->
          <div class="card border-0 shadow-sm sticky-top" style="top: 120px;">
            <div class="card-body">
              <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary btn-lg" [disabled]="isSaving || organizationForm.invalid">
                  <span *ngIf="isSaving" class="spinner-border spinner-border-sm me-2" role="status"></span>
                  <i *ngIf="!isSaving" class="ri-save-line me-1"></i>
                  {{ isSaving ? 'Saving...' : (isEditMode ? 'Update Organization' : 'Create Organization') }}
                </button>
                <button type="button" class="btn btn-soft-secondary btn-lg" (click)="cancel()">
                  <i class="ri-close-line me-1"></i>Cancel
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>
