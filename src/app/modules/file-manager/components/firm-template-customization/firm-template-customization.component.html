<div class="container-fluid p-4">
  <div class="row">
    <div class="col-12">
      <div class="page-title-box d-sm-flex align-items-center justify-content-between">
        <h4 class="mb-sm-0">Firm Template Customization</h4>
        <div class="page-title-right">
          <ol class="breadcrumb m-0">
            <li class="breadcrumb-item"><a href="javascript:void(0);">File Manager</a></li>
            <li class="breadcrumb-item active">Template Customization</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Base Templates -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">Base Templates</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-6 mb-3" *ngFor="let template of baseTemplates">
              <div class="card template-card h-100" 
                   [class.border-primary]="selectedTemplate?.id === template.id"
                   (click)="selectTemplate(template)">
                <div class="card-body text-center">
                  <div class="mb-3">
                    <i class="ri-folder-2-line display-4 text-primary"></i>
                  </div>
                  <h6 class="card-title">{{ template.name }}</h6>
                  <p class="card-text text-muted fs-12">{{ template.description }}</p>
                  <div class="mt-3">
                    <span class="badge bg-secondary-subtle text-secondary">
                      {{ template.practiceArea | titlecase }}
                    </span>
                  </div>
                  <div class="mt-2">
                    <small class="text-muted">
                      {{ template.folders.length }} folders
                    </small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Customization Form -->
    <div class="col-md-6">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">Customize Template</h5>
        </div>
        <div class="card-body">
          <form [formGroup]="customizationForm" (ngSubmit)="saveFirmCustomization()">
            <!-- Basic Info -->
            <div class="mb-3">
              <label class="form-label">Template Name</label>
              <input type="text" class="form-control" formControlName="name" placeholder="Enter custom template name">
            </div>
            
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" formControlName="description" rows="3" placeholder="Enter template description"></textarea>
            </div>

            <!-- Customizations -->
            <div class="mb-3">
              <div class="d-flex justify-content-between align-items-center mb-2">
                <label class="form-label mb-0">Folder Customizations</label>
                <button type="button" class="btn btn-sm btn-outline-primary" (click)="addFolderCustomization()">
                  <i class="ri-add-line me-1"></i>Add Customization
                </button>
              </div>
              
              <div formArrayName="customizations" class="customizations-container">
                <div *ngFor="let customization of customizations.controls; let i = index" 
                     [formGroupName]="i" class="card border-light mb-3">
                  <div class="card-body">
                    <div class="row">
                      <div class="col-md-6">
                        <label class="form-label">Type</label>
                        <select class="form-select" formControlName="type">
                          <option value="add">Add Folder</option>
                          <option value="remove">Remove Folder</option>
                          <option value="modify">Modify Folder</option>
                          <option value="reorder">Reorder Folder</option>
                        </select>
                      </div>
                      <div class="col-md-6">
                        <label class="form-label">Folder Path</label>
                        <input type="text" class="form-control" formControlName="folderPath" 
                               placeholder="e.g., 01-Pleadings/Initial Pleadings">
                      </div>
                    </div>
                    
                    <div formGroupName="action" class="mt-3">
                      <div class="row">
                        <div class="col-md-6">
                          <label class="form-label">Name</label>
                          <input type="text" class="form-control" formControlName="name" placeholder="Folder name">
                        </div>
                        <div class="col-md-6">
                          <label class="form-label">Description</label>
                          <input type="text" class="form-control" formControlName="description" placeholder="Folder description">
                        </div>
                      </div>
                      
                      <div class="row mt-2">
                        <div class="col-md-6">
                          <div class="form-check">
                            <input class="form-check-input" type="checkbox" formControlName="isRequired">
                            <label class="form-check-label">Required Folder</label>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <button type="button" class="btn btn-sm btn-outline-danger" (click)="removeFolderCustomization(i)">
                            <i class="ri-delete-bin-line"></i>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Actions -->
            <div class="text-end">
              <button type="button" class="btn btn-light me-2" (click)="customizationForm.reset()">Reset</button>
              <button type="submit" class="btn btn-primary" [disabled]="customizationForm.invalid || isLoading">
                <i class="ri-save-line me-1"></i>Save Customization
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Existing Customizations -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">Existing Firm Customizations</h5>
        </div>
        <div class="card-body">
          <div class="table-responsive">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Template Name</th>
                  <th>Base Template</th>
                  <th>Practice Area</th>
                  <th>Status</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let customization of firmCustomizations">
                  <td>{{ customization.customizedTemplate.name }}</td>
                  <td>{{ customization.baseTemplateId }}</td>
                  <td>
                    <span class="badge bg-secondary-subtle text-secondary">
                      {{ customization.customizedTemplate.practiceArea | titlecase }}
                    </span>
                  </td>
                  <td>
                    <span class="badge" [class.bg-success]="customization.isActive" [class.bg-secondary]="!customization.isActive">
                      {{ customization.isActive ? 'Active' : 'Inactive' }}
                    </span>
                  </td>
                  <td>{{ customization.createdAt | date:'MMM d, y' }}</td>
                  <td>
                    <div class="d-flex gap-2">
                      <button class="btn btn-sm btn-outline-primary" (click)="previewCustomizedTemplate(customization)">
                        <i class="ri-eye-line"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-secondary" (click)="editFirmCustomization(customization)">
                        <i class="ri-edit-line"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-danger" (click)="deleteFirmCustomization(customization)">
                        <i class="ri-delete-bin-line"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>