<div class="page-content">
  <div class="container-fluid">
    <!-- Page Title -->
    <div class="row">
      <div class="col-12">
        <div class="page-title-box d-flex align-items-center justify-content-between">
          <h4 class="mb-0">Create New Case</h4>
          <div class="page-title-right">
            <ol class="breadcrumb m-0">
              <li class="breadcrumb-item"><a href="/legal/cases">Cases</a></li>
              <li class="breadcrumb-item active">Create Case</li>
            </ol>
          </div>
        </div>
      </div>
    </div>

    <!-- Case Form -->
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="card-header border-bottom-dashed">
            <div class="d-flex align-items-center">
              <h5 class="card-title mb-0 flex-grow-1">Case Information</h5>
              <div class="flex-shrink-0">
                <button type="button" class="btn btn-soft-secondary btn-sm" (click)="cancel()">
                  <i class="ri-arrow-left-line align-middle me-1"></i> Back to Cases
                </button>
              </div>
            </div>
          </div>
          <div class="card-body">
            <form [formGroup]="caseForm" (ngSubmit)="onSubmit()">
              <!-- Client Information -->
              <div class="row mb-4">
                <div class="col-12">
                  <div class="card border shadow-none">
                    <div class="card-header bg-light">
                      <h5 class="card-title mb-0">Client Information</h5>
                    </div>
                    <div class="card-body">
                      <div class="row g-3">
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="clientName" class="form-label">Client Name <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="clientName" formControlName="clientName"
                              [ngClass]="{'is-invalid': hasError('clientName')}" placeholder="Enter client name">
                            <div class="invalid-feedback" *ngIf="hasError('clientName')">
                              {{ getErrorMessage('clientName') }}
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="clientEmail" class="form-label">Client Email <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" id="clientEmail" formControlName="clientEmail"
                              [ngClass]="{'is-invalid': hasError('clientEmail')}" placeholder="Enter client email">
                            <div class="invalid-feedback" *ngIf="hasError('clientEmail')">
                              {{ getErrorMessage('clientEmail') }}
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="clientPhone" class="form-label">Client Phone <span class="text-danger">*</span></label>
                            <input type="tel" class="form-control" id="clientPhone" formControlName="clientPhone"
                              [ngClass]="{'is-invalid': hasError('clientPhone')}" placeholder="Enter client phone">
                            <div class="invalid-feedback" *ngIf="hasError('clientPhone')">
                              {{ getErrorMessage('clientPhone') }}
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="clientAddress" class="form-label">Client Address</label>
                            <input type="text" class="form-control" id="clientAddress" formControlName="clientAddress"
                              placeholder="Enter client address">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Case Information -->
              <div class="row mb-4">
                <div class="col-12">
                  <div class="card border shadow-none">
                    <div class="card-header bg-light">
                      <h5 class="card-title mb-0">Case Details</h5>
                    </div>
                    <div class="card-body">
                      <div class="row g-3">
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="caseNumber" class="form-label">Case Number <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="caseNumber" formControlName="caseNumber"
                              [ngClass]="{'is-invalid': hasError('caseNumber')}" placeholder="Auto-generated">
                            <div class="invalid-feedback" *ngIf="hasError('caseNumber')">
                              {{ getErrorMessage('caseNumber') }}
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="title" class="form-label">Case Title <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="title" formControlName="title"
                              [ngClass]="{'is-invalid': hasError('title')}" placeholder="Enter case title">
                            <div class="invalid-feedback" *ngIf="hasError('title')">
                              {{ getErrorMessage('title') }}
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="practiceArea" class="form-label">Practice Area <span class="text-danger">*</span></label>
                            <select class="form-select" id="practiceArea" formControlName="practiceArea"
                              [ngClass]="{'is-invalid': hasError('practiceArea')}">
                              <option value="">Select Practice Area</option>
                              <option *ngFor="let area of practiceAreas" [value]="area">
                                {{area}}
                              </option>
                            </select>
                            <div class="invalid-feedback" *ngIf="hasError('practiceArea')">
                              {{ getErrorMessage('practiceArea') }}
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="status" class="form-label">Status <span class="text-danger">*</span></label>
                            <select class="form-select" id="status" formControlName="status"
                              [ngClass]="{'is-invalid': hasError('status')}">
                              <option *ngFor="let status of CaseStatus | keyvalue" [value]="status.value">
                                {{status.value}}
                              </option>
                            </select>
                            <div class="invalid-feedback" *ngIf="hasError('status')">
                              {{ getErrorMessage('status') }}
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="priority" class="form-label">Priority <span class="text-danger">*</span></label>
                            <select class="form-select" id="priority" formControlName="priority"
                              [ngClass]="{'is-invalid': hasError('priority')}">
                              <option *ngFor="let priority of CasePriority | keyvalue" [value]="priority.value">
                                {{priority.value}}
                              </option>
                            </select>
                            <div class="invalid-feedback" *ngIf="hasError('priority')">
                              {{ getErrorMessage('priority') }}
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6">
                          <div class="mb-3">
                            <label for="leadAttorneyId" class="form-label">Lead Attorney</label>
                            <select class="form-select" id="leadAttorneyId" formControlName="leadAttorneyId">
                              <option value="">Select Lead Attorney</option>
                              <option *ngFor="let attorney of attorneys" [value]="attorney.id">
                                {{attorney.firstName}} {{attorney.lastName}} ({{attorney.roleName}})
                              </option>
                            </select>
                          </div>
                        </div>
                        <div class="col-12">
                          <div class="mb-3">
                            <label for="description" class="form-label">Case Description <span class="text-danger">*</span></label>
                            <textarea class="form-control" id="description" rows="4" formControlName="description"
                              [ngClass]="{'is-invalid': hasError('description')}" placeholder="Enter case description"></textarea>
                            <div class="invalid-feedback" *ngIf="hasError('description')">
                              {{ getErrorMessage('description') }}
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Practice Area Specific Fields -->
              <div class="row mb-4" *ngIf="currentPracticeAreaSections.length > 0">
                <div class="col-12">
                  <div class="card border shadow-none" *ngFor="let section of currentPracticeAreaSections">
                    <div class="card-header bg-soft-primary">
                      <h5 class="card-title mb-0">
                        <i [class]="section.icon + ' align-middle me-2'" *ngIf="section.icon"></i>
                        {{ section.title }}
                      </h5>
                    </div>
                    <div class="card-body">
                      <div class="row g-3">
                        <ng-container *ngFor="let field of section.fields">
                          <div [class]="field.colSize || 'col-md-6'">
                            <div class="mb-3">
                              <!-- Text Input -->
                              <ng-container *ngIf="field.type === 'text'">
                                <label [for]="'pa_' + field.name" class="form-label">
                                  {{ field.label }}
                                  <span class="text-danger" *ngIf="field.required">*</span>
                                </label>
                                <input type="text" class="form-control" [id]="'pa_' + field.name"
                                  [formControlName]="field.name"
                                  [placeholder]="field.placeholder || ''"
                                  [ngClass]="{'is-invalid': hasError(field.name)}">
                                <div class="invalid-feedback" *ngIf="hasError(field.name)">
                                  {{ getErrorMessage(field.name) }}
                                </div>
                              </ng-container>

                              <!-- Textarea -->
                              <ng-container *ngIf="field.type === 'textarea'">
                                <label [for]="'pa_' + field.name" class="form-label">
                                  {{ field.label }}
                                  <span class="text-danger" *ngIf="field.required">*</span>
                                </label>
                                <textarea class="form-control" [id]="'pa_' + field.name" rows="3"
                                  [formControlName]="field.name"
                                  [placeholder]="field.placeholder || ''"
                                  [ngClass]="{'is-invalid': hasError(field.name)}"></textarea>
                                <div class="invalid-feedback" *ngIf="hasError(field.name)">
                                  {{ getErrorMessage(field.name) }}
                                </div>
                              </ng-container>

                              <!-- Select -->
                              <ng-container *ngIf="field.type === 'select'">
                                <label [for]="'pa_' + field.name" class="form-label">
                                  {{ field.label }}
                                  <span class="text-danger" *ngIf="field.required">*</span>
                                </label>
                                <select class="form-select" [id]="'pa_' + field.name"
                                  [formControlName]="field.name"
                                  [ngClass]="{'is-invalid': hasError(field.name)}">
                                  <option value="">Select {{ field.label }}</option>
                                  <option *ngFor="let opt of field.options" [value]="opt.value">
                                    {{ opt.label }}
                                  </option>
                                </select>
                                <div class="invalid-feedback" *ngIf="hasError(field.name)">
                                  {{ getErrorMessage(field.name) }}
                                </div>
                              </ng-container>

                              <!-- Date -->
                              <ng-container *ngIf="field.type === 'date'">
                                <label [for]="'pa_' + field.name" class="form-label">
                                  {{ field.label }}
                                  <span class="text-danger" *ngIf="field.required">*</span>
                                </label>
                                <div class="input-group">
                                  <span class="input-group-text bg-light border-end-0">
                                    <i class="ri-calendar-line align-middle"></i>
                                  </span>
                                  <input type="text" class="form-control border-start-0 flatpickr-input"
                                    [id]="'pa_' + field.name"
                                    [formControlName]="field.name"
                                    [placeholder]="'Select ' + field.label"
                                    [ngClass]="{'is-invalid': hasError(field.name)}">
                                </div>
                                <div class="invalid-feedback d-block" *ngIf="hasError(field.name)">
                                  {{ getErrorMessage(field.name) }}
                                </div>
                              </ng-container>

                              <!-- Currency -->
                              <ng-container *ngIf="field.type === 'currency'">
                                <label [for]="'pa_' + field.name" class="form-label">
                                  {{ field.label }}
                                  <span class="text-danger" *ngIf="field.required">*</span>
                                </label>
                                <div class="input-group">
                                  <span class="input-group-text bg-light border-end-0">
                                    <i class="ri-money-dollar-circle-line align-middle"></i>
                                  </span>
                                  <input type="number" class="form-control border-start-0"
                                    [id]="'pa_' + field.name"
                                    [formControlName]="field.name"
                                    [placeholder]="field.placeholder || '0.00'"
                                    min="0" step="0.01"
                                    [ngClass]="{'is-invalid': hasError(field.name)}">
                                </div>
                                <div class="invalid-feedback" *ngIf="hasError(field.name)">
                                  {{ getErrorMessage(field.name) }}
                                </div>
                              </ng-container>

                              <!-- Number -->
                              <ng-container *ngIf="field.type === 'number'">
                                <label [for]="'pa_' + field.name" class="form-label">
                                  {{ field.label }}
                                  <span class="text-danger" *ngIf="field.required">*</span>
                                </label>
                                <input type="number" class="form-control"
                                  [id]="'pa_' + field.name"
                                  [formControlName]="field.name"
                                  [placeholder]="field.placeholder || '0'"
                                  min="0"
                                  [ngClass]="{'is-invalid': hasError(field.name)}">
                                <div class="invalid-feedback" *ngIf="hasError(field.name)">
                                  {{ getErrorMessage(field.name) }}
                                </div>
                              </ng-container>

                              <!-- Checkbox -->
                              <ng-container *ngIf="field.type === 'checkbox'">
                                <div class="form-check mt-4">
                                  <input type="checkbox" class="form-check-input"
                                    [id]="'pa_' + field.name"
                                    [formControlName]="field.name">
                                  <label class="form-check-label" [for]="'pa_' + field.name">
                                    {{ field.label }}
                                  </label>
                                </div>
                              </ng-container>
                            </div>
                          </div>
                        </ng-container>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Court Information (Optional) -->
              <div class="row mb-4">
                <div class="col-12">
                  <div class="card border shadow-none">
                    <div class="card-header bg-light">
                      <h5 class="card-title mb-0">Court Information <span class="text-muted fs-12 fw-normal">(Optional - can be added later)</span></h5>
                    </div>
                    <div class="card-body">
                      <div class="row g-3">
                        <div class="col-md-4">
                          <div class="mb-3">
                            <label for="countyName" class="form-label">County Name</label>
                            <input type="text" class="form-control" id="countyName" formControlName="countyName"
                              placeholder="Enter county name">
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="mb-3">
                            <label for="judgeName" class="form-label">Judge Name</label>
                            <input type="text" class="form-control" id="judgeName" formControlName="judgeName"
                              placeholder="Enter judge name">
                          </div>
                        </div>
                        <div class="col-md-4">
                          <div class="mb-3">
                            <label for="courtroom" class="form-label">Courtroom</label>
                            <input type="text" class="form-control" id="courtroom" formControlName="courtroom"
                              placeholder="Enter courtroom">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Important Dates -->
              <div class="row mb-4">
                <div class="col-12">
                  <div class="card border shadow-none">
                    <div class="card-header bg-light">
                      <h5 class="card-title mb-0">Important Dates</h5>
                    </div>
                    <div class="card-body">
                      <div class="row g-3">
                        <div class="col-md-6 col-lg-3">
                          <div class="mb-3">
                            <label for="filingDate" class="form-label">Filing Date <span class="text-danger">*</span></label>
                            <div class="input-group">
                              <span class="input-group-text bg-light border-end-0">
                                <i class="ri-calendar-line align-middle"></i>
                              </span>
                              <input type="text"
                                     class="form-control border-start-0 flatpickr-input"
                                     id="filingDate"
                                     formControlName="filingDate"
                                     [ngClass]="{'is-invalid': hasError('filingDate')}"
                                     placeholder="Select filing date"
                                     #filingDate>
                            </div>
                            <div class="invalid-feedback" *ngIf="hasError('filingDate')">
                              {{ getErrorMessage('filingDate') }}
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                          <div class="mb-3">
                            <label for="statuteOfLimitationsDate" class="form-label">Statute of Limitations</label>
                            <div class="input-group">
                              <span class="input-group-text bg-light border-end-0">
                                <i class="ri-error-warning-line align-middle text-danger"></i>
                              </span>
                              <input type="text"
                                     class="form-control border-start-0 flatpickr-input"
                                     id="statuteOfLimitationsDate"
                                     formControlName="statuteOfLimitationsDate"
                                     placeholder="Critical deadline"
                                     #statuteOfLimitationsDate>
                            </div>
                            <small class="text-muted">Critical deadline - set if applicable</small>
                          </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                          <div class="mb-3">
                            <label for="nextHearingDate" class="form-label">Next Hearing Date</label>
                            <div class="input-group">
                              <span class="input-group-text bg-light border-end-0">
                                <i class="ri-calendar-line align-middle"></i>
                              </span>
                              <input type="text"
                                     class="form-control border-start-0 flatpickr-input"
                                     id="nextHearingDate"
                                     formControlName="nextHearingDate"
                                     placeholder="Select next hearing date"
                                     #nextHearingDate>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                          <div class="mb-3">
                            <label for="estimatedCompletionDate" class="form-label">Est. Completion Date</label>
                            <div class="input-group">
                              <span class="input-group-text bg-light border-end-0">
                                <i class="ri-calendar-line align-middle"></i>
                              </span>
                              <input type="text"
                                     class="form-control border-start-0 flatpickr-input"
                                     id="estimatedCompletionDate"
                                     formControlName="estimatedCompletionDate"
                                     placeholder="Select completion date"
                                     #estimatedCompletionDate>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Billing Information Section -->
              <div class="row mb-4">
                <div class="col-12">
                  <div class="card border shadow-none">
                    <div class="card-header bg-light">
                      <h5 class="card-title mb-0">Billing Information</h5>
                    </div>
                    <div class="card-body">
                      <div class="row g-3">
                        <div class="col-md-6 col-lg-3">
                          <div class="mb-3">
                            <label for="billingType" class="form-label">Billing Type <span class="text-danger">*</span></label>
                            <select class="form-select" id="billingType" formControlName="billingType"
                              [ngClass]="{'is-invalid': hasError('billingType')}">
                              <option *ngFor="let type of billingTypes" [value]="type.value">
                                {{type.label}}
                              </option>
                            </select>
                            <div class="invalid-feedback" *ngIf="hasError('billingType')">
                              {{ getErrorMessage('billingType') }}
                            </div>
                          </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                          <div class="mb-3">
                            <label for="hourlyRate" class="form-label">Hourly Rate</label>
                            <div class="input-group">
                              <span class="input-group-text bg-light border-end-0">
                                <i class="ri-money-dollar-circle-line align-middle"></i>
                              </span>
                              <input type="number" class="form-control border-start-0" id="hourlyRate" formControlName="hourlyRate"
                                placeholder="0.00" min="0" step="0.01">
                            </div>
                            <small class="text-muted">Required for hourly billing</small>
                          </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                          <div class="mb-3">
                            <label for="retainerAmount" class="form-label">Retainer Amount</label>
                            <div class="input-group">
                              <span class="input-group-text bg-light border-end-0">
                                <i class="ri-money-dollar-circle-line align-middle"></i>
                              </span>
                              <input type="number" class="form-control border-start-0" id="retainerAmount" formControlName="retainerAmount"
                                placeholder="0.00" min="0" step="0.01">
                            </div>
                            <small class="text-muted">Initial retainer if applicable</small>
                          </div>
                        </div>
                        <div class="col-md-6 col-lg-3">
                          <div class="mb-3">
                            <label for="paymentStatus" class="form-label">Payment Status</label>
                            <select class="form-select" id="paymentStatus" formControlName="paymentStatus">
                              <option *ngFor="let status of PaymentStatus | keyvalue" [value]="status.value">
                                {{status.value}}
                              </option>
                            </select>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Form Actions -->
              <div class="row mt-4">
                <div class="col-12">
                  <div class="d-flex justify-content-end gap-2">
                    <button type="button" class="btn btn-soft-secondary btn-lg px-4" (click)="cancel()">
                      Cancel
                    </button>
                    <button type="submit" class="btn btn-soft-primary btn-lg px-4" [disabled]="isLoading">
                      <span class="spinner-border spinner-border-sm me-1" *ngIf="isLoading"></span>
                      <i class="ri-save-line align-middle me-1" *ngIf="!isLoading"></i> Create Case
                    </button>
                  </div>
                </div>
              </div>

              <!-- Error Message -->
              <div class="row mt-3" *ngIf="errorMessage">
                <div class="col-12">
                  <div class="alert alert-danger" role="alert">
                    <i class="ri-error-warning-line align-middle me-2"></i> {{ errorMessage }}
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </div>
</div> 