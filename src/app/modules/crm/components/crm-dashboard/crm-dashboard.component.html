<!-- Page Header -->
<div class="row" style="margin-top: 120px;">
  <div class="col-12">
    <div class="page-title-box d-sm-flex align-items-center justify-content-between">
      <h4 class="mb-sm-0">
        <i class="ri-customer-service-2-line me-2 text-primary"></i>
        CRM Dashboard
      </h4>
      
      <div class="page-title-right">
        <ol class="breadcrumb m-0">
          <li class="breadcrumb-item"><a href="/">Home</a></li>
          <li class="breadcrumb-item active">CRM Dashboard</li>
        </ol>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="row" *ngIf="isLoading">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-body text-center py-5">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Loading dashboard...</span>
        </div>
        <p class="mt-3 text-muted">Loading CRM dashboard...</p>
      </div>
    </div>
  </div>
</div>

<!-- Dashboard Content -->
<div class="row" *ngIf="!isLoading && !error">
  
  <!-- Statistics Cards -->
  <div class="col-xl-3 col-md-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="flex-shrink-0">
            <div class="avatar-sm rounded-circle bg-warning bg-opacity-10 p-2">
              <div class="avatar-title text-warning rounded-circle bg-transparent">
                <i class="ri-file-list-3-line fs-2"></i>
              </div>
            </div>
          </div>
          <div class="flex-grow-1 ms-3">
            <h5 class="mb-1">{{ dashboardData.submissionCounts?.PENDING || 0 }}</h5>
            <p class="text-muted mb-0 fs-13">Pending Submissions</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="flex-shrink-0">
            <div class="avatar-sm rounded-circle bg-success bg-opacity-10 p-2">
              <div class="avatar-title text-success rounded-circle bg-transparent">
                <i class="ri-user-add-line fs-2"></i>
              </div>
            </div>
          </div>
          <div class="flex-grow-1 ms-3">
            <h5 class="mb-1">{{ dashboardData.submissionCounts?.CONVERTED_TO_LEAD || 0 }}</h5>
            <p class="text-muted mb-0 fs-13">Converted to Leads</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="flex-shrink-0">
            <div class="avatar-sm rounded-circle bg-primary bg-opacity-10 p-2">
              <div class="avatar-title text-primary rounded-circle bg-transparent">
                <i class="ri-percentage-line fs-2"></i>
              </div>
            </div>
          </div>
          <div class="flex-grow-1 ms-3">
            <h5 class="mb-1">{{ dashboardData.conversionStats?.conversionRate || 0 }}%</h5>
            <p class="text-muted mb-0 fs-13">Conversion Rate</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-xl-3 col-md-6">
    <div class="card shadow-sm">
      <div class="card-body">
        <div class="d-flex align-items-center">
          <div class="flex-shrink-0">
            <div class="avatar-sm rounded-circle bg-info bg-opacity-10 p-2">
              <div class="avatar-title text-info rounded-circle bg-transparent">
                <i class="ri-file-chart-line fs-2"></i>
              </div>
            </div>
          </div>
          <div class="flex-grow-1 ms-3">
            <h5 class="mb-1">{{ dashboardData.conversionStats?.totalSubmissions || 0 }}</h5>
            <p class="text-muted mb-0 fs-13">Total Submissions</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Status Breakdown -->
<div class="row" *ngIf="!isLoading && !error">
  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-header bg-light-subtle border-bottom-dashed">
        <h5 class="card-title mb-0">
          <i class="ri-pie-chart-2-line me-2 text-primary"></i>
          Status Breakdown
        </h5>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-6" *ngFor="let status of objectKeys(dashboardData.submissionCounts || {})">
            <div class="d-flex align-items-center p-3 border rounded">
              <span class="badge me-3" [ngClass]="getStatusBadgeClass(status)">
                {{ dashboardData.submissionCounts[status] }}
              </span>
              <div>
                <h6 class="mb-0">{{ status.replace('_', ' ') }}</h6>
                <small class="text-muted">Submissions</small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="card shadow-sm">
      <div class="card-header bg-light-subtle border-bottom-dashed">
        <h5 class="card-title mb-0">
          <i class="ri-scales-3-line me-2 text-primary"></i>
          Practice Areas
        </h5>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-12" *ngFor="let area of objectKeys(dashboardData.practiceAreaCounts || {})">
            <div class="d-flex align-items-center justify-content-between py-2 border-bottom">
              <span class="fw-medium">{{ area }}</span>
              <span class="badge bg-primary-subtle text-primary">
                {{ dashboardData.practiceAreaCounts[area] }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Quick Actions -->
<div class="row" *ngIf="!isLoading && !error">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-header bg-light-subtle border-bottom-dashed">
        <h5 class="card-title mb-0">
          <i class="ri-flashlight-line me-2 text-primary"></i>
          Quick Actions
        </h5>
      </div>
      <div class="card-body">
        <div class="row g-3">
          <div class="col-lg-3 col-md-6">
            <div class="card border h-100 cursor-pointer" (click)="navigateToSubmissions()">
              <div class="card-body text-center p-4">
                <div class="avatar-md mx-auto mb-3">
                  <div class="avatar-title rounded-circle bg-warning-subtle text-warning">
                    <i class="ri-file-list-3-line fs-2"></i>
                  </div>
                </div>
                <h6 class="mb-2">Review Submissions</h6>
                <p class="text-muted mb-0 fs-13">Review pending intake submissions</p>
              </div>
            </div>
          </div>
          
          <div class="col-lg-3 col-md-6">
            <div class="card border h-100 cursor-pointer" (click)="navigateToLeads()">
              <div class="card-body text-center p-4">
                <div class="avatar-md mx-auto mb-3">
                  <div class="avatar-title rounded-circle bg-success-subtle text-success">
                    <i class="ri-user-add-line fs-2"></i>
                  </div>
                </div>
                <h6 class="mb-2">Manage Leads</h6>
                <p class="text-muted mb-0 fs-13">View and manage lead pipeline</p>
              </div>
            </div>
          </div>

          <div class="col-lg-3 col-md-6">
            <div class="card border h-100 cursor-pointer" (click)="navigateToConflictChecks()">
              <div class="card-body text-center p-4">
                <div class="avatar-md mx-auto mb-3">
                  <div class="avatar-title rounded-circle bg-info-subtle text-info">
                    <i class="ri-shield-check-line fs-2"></i>
                  </div>
                </div>
                <h6 class="mb-2">Conflict Checks</h6>
                <p class="text-muted mb-0 fs-13">Review conflict check results</p>
              </div>
            </div>
          </div>

          <div class="col-lg-3 col-md-6">
            <div class="card border h-100">
              <div class="card-body text-center p-4">
                <div class="avatar-md mx-auto mb-3">
                  <div class="avatar-title rounded-circle bg-primary-subtle text-primary">
                    <i class="ri-line-chart-line fs-2"></i>
                  </div>
                </div>
                <h6 class="mb-2">Analytics</h6>
                <p class="text-muted mb-0 fs-13">View detailed reports</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Error State -->
<div class="row" *ngIf="error && !isLoading">
  <div class="col-12">
    <div class="card shadow-sm">
      <div class="card-body text-center py-5">
        <div class="avatar-lg mx-auto mb-4">
          <div class="avatar-title rounded-circle bg-soft-danger text-danger">
            <i class="ri-error-warning-line display-6"></i>
          </div>
        </div>
        <h5 class="mb-3 text-danger">Error Loading Dashboard</h5>
        <p class="text-muted mb-4">{{ error }}</p>
        <button class="btn btn-primary" (click)="loadDashboardData()">
          <i class="ri-refresh-line me-1"></i>Try Again
        </button>
      </div>
    </div>
  </div>
</div>