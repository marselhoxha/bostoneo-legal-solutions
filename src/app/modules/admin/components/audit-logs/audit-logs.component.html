<div class="container-fluid">
  <!-- Page Title -->
  <div class="row">
    <div class="col-12">
      <div class="page-title-box d-sm-flex align-items-center justify-content-between">
        <h4 class="mb-sm-0">Audit Logs</h4>
        <div class="page-title-right">
          <ol class="breadcrumb m-0">
            <li class="breadcrumb-item"><a routerLink="/dashboard">Dashboard</a></li>
            <li class="breadcrumb-item"><a routerLink="/admin">Admin</a></li>
            <li class="breadcrumb-item active">Audit Logs</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Filters Card -->
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="ri-filter-3-line me-2"></i>Filters
          </h5>
        </div>
        <div class="card-body">
          <form [formGroup]="filterForm" (ngSubmit)="applyFilters()">
            <div class="row g-3">
              <div class="col-md-2">
                <label class="form-label">User ID</label>
                <input type="text" class="form-control" formControlName="userId" placeholder="User ID">
              </div>
              <div class="col-md-2">
                <label class="form-label">Action Type</label>
                <select class="form-select" formControlName="action">
                  <option value="">All Actions</option>
                  <option *ngFor="let action of actionTypes" [value]="action">{{action}}</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label">Resource Type</label>
                <select class="form-select" formControlName="resource">
                  <option value="">All Resources</option>
                  <option *ngFor="let resource of resourceTypes" [value]="resource">{{resource}}</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label">From Date</label>
                <input type="date" class="form-control" formControlName="dateFrom">
              </div>
              <div class="col-md-2">
                <label class="form-label">To Date</label>
                <input type="date" class="form-control" formControlName="dateTo">
              </div>
              <div class="col-md-2 d-flex align-items-end gap-2">
                <button type="submit" class="btn btn-primary">
                  <i class="ri-search-line me-1"></i>Search
                </button>
                <button type="button" class="btn btn-soft-secondary" (click)="clearFilters()">
                  <i class="ri-refresh-line"></i>
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="row">
    <!-- Audit Logs Table -->
    <div class="col-xl-8">
      <div class="card">
        <div class="card-header d-flex align-items-center">
          <h5 class="card-title mb-0 flex-grow-1">
            <i class="ri-file-list-3-line me-2"></i>Audit Log Entries
          </h5>
          <div class="flex-shrink-0">
            <button class="btn btn-soft-primary btn-sm" (click)="exportAuditLogs()">
              <i class="ri-download-2-line me-1"></i>Export
            </button>
          </div>
        </div>
        <div class="card-body">
          <!-- Loading State -->
          <div *ngIf="loading" class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <p class="text-muted mt-2 mb-0">Loading audit logs...</p>
          </div>

          <!-- Table -->
          <div class="table-responsive" *ngIf="!loading && auditLogs.length > 0">
            <table class="table table-hover align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th>Timestamp</th>
                  <th>User</th>
                  <th>Action</th>
                  <th>Resource</th>
                  <th>Details</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let log of auditLogs">
                  <td>
                    <span class="text-muted fs-12">{{formatTimestamp(log.timestamp)}}</span>
                  </td>
                  <td>
                    <span class="fw-medium">{{log.userId || 'System'}}</span>
                  </td>
                  <td>
                    <span class="d-flex align-items-center">
                      <i [ngClass]="getActionIcon(log.action)" [ngClass]="getActionColor(log.action)" class="me-2"></i>
                      <span class="badge" [ngClass]="{
                        'bg-danger-subtle text-danger': log.action?.includes('DELETE'),
                        'bg-success-subtle text-success': log.action?.includes('CREATE'),
                        'bg-warning-subtle text-warning': log.action?.includes('UPDATE'),
                        'bg-info-subtle text-info': !log.action?.includes('DELETE') && !log.action?.includes('CREATE') && !log.action?.includes('UPDATE')
                      }">{{log.action}}</span>
                    </span>
                  </td>
                  <td>
                    <span class="badge bg-secondary-subtle text-secondary">{{log.entityType}}</span>
                    <span *ngIf="log.entityId" class="text-muted ms-1">#{{log.entityId}}</span>
                  </td>
                  <td>
                    <span class="text-truncate d-inline-block" style="max-width: 200px;" [title]="log.details">
                      {{log.details || '-'}}
                    </span>
                  </td>
                  <td>
                    <span class="badge" [ngClass]="log.success ? 'bg-success' : 'bg-danger'">
                      {{log.success ? 'Success' : 'Failed'}}
                    </span>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Empty State -->
          <div *ngIf="!loading && auditLogs.length === 0" class="text-center py-5">
            <div class="avatar-md mx-auto mb-3">
              <span class="avatar-title bg-light text-muted rounded-circle fs-24">
                <i class="ri-file-list-3-line"></i>
              </span>
            </div>
            <h5 class="text-muted">No Audit Logs Found</h5>
            <p class="text-muted mb-0">Try adjusting your filters or check back later</p>
          </div>

          <!-- Pagination -->
          <div class="d-flex justify-content-between align-items-center mt-3" *ngIf="auditLogs.length > 0">
            <span class="text-muted fs-13">
              Showing page {{currentPage + 1}} of {{totalPages || 1}}
            </span>
            <nav>
              <ul class="pagination pagination-sm mb-0">
                <li class="page-item" [class.disabled]="currentPage === 0">
                  <a class="page-link" href="javascript:void(0)" (click)="onPageChange(currentPage - 1)">Previous</a>
                </li>
                <li class="page-item" [class.disabled]="currentPage >= totalPages - 1">
                  <a class="page-link" href="javascript:void(0)" (click)="onPageChange(currentPage + 1)">Next</a>
                </li>
              </ul>
            </nav>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Activity Sidebar -->
    <div class="col-xl-4">
      <div class="card">
        <div class="card-header">
          <h5 class="card-title mb-0">
            <i class="ri-time-line me-2"></i>Recent Activity
          </h5>
        </div>
        <div class="card-body">
          <div class="acitivity-timeline" *ngIf="recentActivities.length > 0">
            <div class="acitivity-item d-flex" *ngFor="let activity of recentActivities">
              <div class="flex-shrink-0">
                <div class="avatar-xs acitivity-avatar">
                  <div class="avatar-title rounded-circle" [ngClass]="{
                    'bg-danger-subtle text-danger': activity.action?.includes('DELETE'),
                    'bg-success-subtle text-success': activity.action?.includes('CREATE'),
                    'bg-warning-subtle text-warning': activity.action?.includes('UPDATE'),
                    'bg-info-subtle text-info': !activity.action?.includes('DELETE') && !activity.action?.includes('CREATE') && !activity.action?.includes('UPDATE')
                  }">
                    <i [ngClass]="getActionIcon(activity.action)"></i>
                  </div>
                </div>
              </div>
              <div class="flex-grow-1 ms-3">
                <h6 class="mb-1">{{activity.action}}</h6>
                <p class="text-muted mb-1 fs-12">{{activity.details || activity.entityType}}</p>
                <small class="text-muted">{{formatTimestamp(activity.timestamp)}}</small>
              </div>
            </div>
          </div>
          <div *ngIf="recentActivities.length === 0" class="text-center py-4">
            <i class="ri-time-line fs-24 text-muted"></i>
            <p class="text-muted mb-0 mt-2">No recent activity</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
